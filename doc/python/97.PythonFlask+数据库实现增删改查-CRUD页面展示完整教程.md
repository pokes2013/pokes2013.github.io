# PythonFlask+数据库实现增删改查(CRUD)+页面展示完整教程
你需要的是基于 Flask 框架实现「数据库数据在HTML页面展示+完整的增删改查(CRUD)功能」，我给你提供一套**完整、可直接运行、带详细注释**的代码，包含所有核心功能，使用最轻量化的SQLite数据库（无需额外安装数据库软件，开箱即用），页面用原生HTML+简单样式实现，逻辑清晰易修改。

## 功能说明
✅ 查询：数据库所有数据渲染展示到HTML页面  
✅ 新增：页面表单提交新增数据到数据库  
✅ 修改：点击编辑按钮，回显数据到表单，提交修改  
✅ 删除：点击删除按钮，删除对应行数据  
✅ 所有操作均有页面提示，数据实时刷新，完整闭环

---

## 一、完整项目代码（直接复制可用）
### 项目结构（极简，单文件搞定）
```
└── app.py  # Flask主程序+路由+数据库操作+所有逻辑
```
### app.py 完整代码
```python
from flask import Flask, render_template_string, request, redirect, url_for, flash
import sqlite3
import os

# 初始化Flask应用
app = Flask(__name__)
# 必须设置秘钥，用于flash消息提示（页面提示语）
app.secret_key = "your_secret_key_123"  # 可随便改，推荐字母+数字组合

# ===================== 数据库相关配置 =====================
# 数据库文件路径，当前目录下的 user.db 文件
DATABASE = "user.db"

# 获取数据库连接
def get_db_connection():
    conn = sqlite3.connect(DATABASE)
    # 设置查询结果为 字典格式 ，方便取值（默认是元组）
    conn.row_factory = sqlite3.Row
    return conn

# 初始化数据库表（启动时自动创建，如果不存在）
def init_db():
    conn = get_db_connection()
    # 创建用户表：id(主键自增)、姓名、年龄、邮箱、地址
    conn.execute('''
        CREATE TABLE IF NOT EXISTS users (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT NOT NULL,
            age INTEGER NOT NULL,
            email TEXT UNIQUE NOT NULL,
            address TEXT
        )
    ''')
    conn.commit()
    conn.close()

# 程序启动时执行初始化数据库
init_db()

# ===================== 核心路由 & 增删改查功能 =====================
# 【查】首页-查询所有数据，展示到页面
@app.route('/')
def index():
    conn = get_db_connection()
    # 查询users表所有数据，按id倒序排列（最新的在最上面）
    users = conn.execute('SELECT * FROM users ORDER BY id DESC').fetchall()
    conn.close()
    # 渲染HTML页面，并把查询到的users数据传给页面
    return render_template_string(html_template, users=users)

# 【增】新增数据-接收表单提交的新增请求
@app.route('/add', methods=['POST'])
def add_user():
    # 获取表单提交的前端数据
    name = request.form['name']
    age = request.form['age']
    email = request.form['email']
    address = request.form['address']

    if not all([name, age, email]):
        flash('姓名、年龄、邮箱为必填项！')
        return redirect(url_for('index'))

    try:
        conn = get_db_connection()
        # 插入新数据到数据库
        conn.execute(
            'INSERT INTO users (name, age, email, address) VALUES (?, ?, ?, ?)',
            (name, age, email, address)
        )
        conn.commit()
        conn.close()
        flash('用户添加成功！')
    except sqlite3.IntegrityError:
        # 邮箱设置了唯一约束，重复会报错
        flash('错误：该邮箱已存在！')
    except Exception as e:
        flash(f'添加失败：{str(e)}')
    # 新增完成后，重定向回首页
    return redirect(url_for('index'))

# 【改】编辑数据-两步：①回显数据 ②提交修改
# ① 点击编辑按钮，根据id查询单条数据，回显到表单
@app.route('/edit/<int:user_id>')
def edit_user(user_id):
    conn = get_db_connection()
    # 根据id查询要修改的单条数据
    user = conn.execute('SELECT * FROM users WHERE id = ?', (user_id,)).fetchone()
    conn.close()
    # 渲染页面，传入要编辑的user数据，页面会自动填充表单
    return render_template_string(html_template, users=get_all_users(), edit_user=user)

# ② 提交修改后的表单数据，更新数据库
@app.route('/update/<int:user_id>', methods=['POST'])
def update_user(user_id):
    name = request.form['name']
    age = request.form['age']
    email = request.form['email']
    address = request.form['address']

    if not all([name, age, email]):
        flash('姓名、年龄、邮箱为必填项！')
        return redirect(url_for('edit_user', user_id=user_id))

    try:
        conn = get_db_connection()
        # 更新对应id的数据
        conn.execute(
            'UPDATE users SET name = ?, age = ?, email = ?, address = ? WHERE id = ?',
            (name, age, email, address, user_id)
        )
        conn.commit()
        conn.close()
        flash('用户信息修改成功！')
    except sqlite3.IntegrityError:
        flash('错误：该邮箱已存在！')
    except Exception as e:
        flash(f'修改失败：{str(e)}')
    return redirect(url_for('index'))

# 【删】删除数据-根据id删除单条数据
@app.route('/delete/<int:user_id>')
def delete_user(user_id):
    try:
        conn = get_db_connection()
        conn.execute('DELETE FROM users WHERE id = ?', (user_id,))
        conn.commit()
        conn.close()
        flash('用户删除成功！')
    except Exception as e:
        flash(f'删除失败：{str(e)}')
    return redirect(url_for('index'))

# 辅助函数：查询所有用户数据
def get_all_users():
    conn = get_db_connection()
    users = conn.execute('SELECT * FROM users ORDER BY id DESC').fetchall()
    conn.close()
    return users

# ===================== HTML页面模板（内置，无需单独创建html文件） =====================
html_template = '''
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Flask 增删改查 演示</title>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;}
        body {padding:20px;font-family:Arial, sans-serif;max-width:1000px;margin:0 auto;}
        h1 {text-align:center;color:#333;margin-bottom:20px;}
        .form-box {border:1px solid #ccc;padding:20px;border-radius:8px;margin-bottom:30px;}
        .form-item {margin-bottom:12px;}
        label {display:inline-block;width:80px;font-weight:bold;}
        input {padding:6px;width:300px;border:1px solid #ccc;border-radius:4px;}
        button {padding:8px 16px;background:#007bff;color:white;border:none;border-radius:4px;cursor:pointer;margin-right:8px;}
        button:hover {background:#0056b3;}
        .btn-edit {background:#28a745;}
        .btn-edit:hover {background:#218838;}
        .btn-del {background:#dc3545;}
        .btn-del:hover {background:#c82333;}
        table {width:100%;border-collapse:collapse;margin-top:20px;}
        th,td {border:1px solid #ccc;padding:10px;text-align:center;}
        th {background:#f8f9fa;font-weight:bold;}
        tr:nth-child(even) {background:#f2f2f2;}
        .flash-msg {padding:10px;margin:20px 0;border-radius:4px;text-align:center;font-weight:bold;}
        .success {background:#d4edda;color:#155724;border:1px solid #c3e6cb;}
        .danger {background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}
    </style>
</head>
<body>
    <h1>Flask + SQLite 增删改查(CRUD) 演示</h1>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for msg in messages %}
                <div class="flash-msg {% if '成功' in msg %}success{% else %}danger{% endif %}">{{ msg }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- 新增/编辑表单 -->
    <div class="form-box">
        <h3>{% if edit_user %}编辑用户{% else %}新增用户{% endif %}</h3>
        <form method="post" action="{% if edit_user %}/update/{{edit_user.id}}{% else %}/add{% endif %}">
            <div class="form-item">
                <label>姓名：</label>
                <input type="text" name="name" value="{{ edit_user.name if edit_user else '' }}" required>
            </div>
            <div class="form-item">
                <label>年龄：</label>
                <input type="number" name="age" value="{{ edit_user.age if edit_user else '' }}" required>
            </div>
            <div class="form-item">
                <label>邮箱：</label>
                <input type="email" name="email" value="{{ edit_user.email if edit_user else '' }}" required>
            </div>
            <div class="form-item">
                <label>地址：</label>
                <input type="text" name="address" value="{{ edit_user.address if edit_user else '' }}">
            </div>
            <div class="form-item">
                <button type="submit">{% if edit_user %}提交修改{% else %}添加用户{% endif %}</button>
                {% if edit_user %}<a href="/"><button type="button">取消</button></a>{% endif %}
            </div>
        </form>
    </div>

    <!-- 数据展示表格 -->
    <div>
        <h3>用户数据列表 (共 {{ users|length }} 条)</h3>
        {% if users %}
            <table>
                <tr>
                    <th>ID</th>
                    <th>姓名</th>
                    <th>年龄</th>
                    <th>邮箱</th>
                    <th>地址</th>
                    <th>操作</th>
                </tr>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.name }}</td>
                    <td>{{ user.age }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.address }}</td>
                    <td>
                        <a href="/edit/{{ user.id }}"><button class="btn-edit">编辑</button></a>
                        <a href="/delete/{{ user.id }}" onclick="return confirm('确定要删除这条数据吗？')"><button class="btn-del">删除</button></a>
                    </td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <p style="text-align:center;margin-top:20px;color:#666;">暂无用户数据，请添加！</p>
        {% endif %}
    </div>
</body>
</html>
'''

# 启动程序
if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)
```

---

## 二、运行前准备 & 启动步骤
### 1. 安装依赖
代码只依赖 `flask` 一个库，执行命令安装即可：
```bash
pip install flask
```

### 2. 启动项目
直接运行 `app.py` 文件，控制台会输出启动日志，默认访问地址：
```
http://127.0.0.1:5000
```
✅ 启动后会自动在当前目录生成 `user.db` SQLite数据库文件，无需手动创建！

---

## 三、核心知识点讲解（方便你修改和扩展）
### ✅ 为什么用SQLite？
- 轻量化、零配置、无需安装数据库服务，数据存在单个`.db`文件中，适合开发/演示/小型项目
- 语法和MySQL/PostgreSQL基本一致，后续想换成MySQL，只需要修改**数据库连接部分**即可，业务逻辑无需改动

### ✅ 核心技术点解析
1. **数据库连接封装**：`get_db_connection()` 统一管理连接，避免重复代码，设置`row_factory = sqlite3.Row`让查询结果是字典，取值更直观（`user['name']`）。
2. **Flash消息提示**：`flash('提示语')` 实现页面操作反馈，比如「添加成功」「删除失败」，提升用户体验。
3. **路由设计规范**：
   - 查：`GET /`  查询所有数据
   - 增：`POST /add`  提交新增数据
   - 改：`GET /edit/id` 回显数据、`POST /update/id` 提交修改
   - 删：`GET /delete/id` 删除数据
4. **模板渲染**：用`render_template_string`内置HTML模板，无需单独创建`templates`文件夹，极简项目结构。

---

## 四、扩展修改建议（按需调整）
### ✅ 1. 修改数据库表结构（比如加字段）
找到 `init_db()` 函数里的`CREATE TABLE`语句，新增字段即可，例如加一个`phone`字段：
```python
conn.execute('''
    CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        age INTEGER NOT NULL,
        email TEXT UNIQUE NOT NULL,
        phone TEXT,  # 新增手机号字段
        address TEXT
    )
''')
```
然后在HTML模板的表单和表格里，对应新增手机号的输入框和列即可。

### ✅ 2. 换成MySQL数据库
如果项目需要用MySQL，只需要做2个修改：
① 安装MySQL依赖：`pip install flask-mysqldb` 或 `pip install pymysql`
② 替换`get_db_connection()` 为MySQL连接，SQL语句完全不变！

### ✅ 3. 美化页面
HTML模板里的`<style>`部分可以自由修改样式，比如调整颜色、表格宽度、表单布局等，也可以引入Bootstrap实现更美观的UI。

---

## 五、运行效果
1. 访问 `http://127.0.0.1:5000` 看到「新增用户」表单和空白表格
2. 填写表单点击「添加用户」，数据会实时显示在表格中
3. 点击「编辑」，表单会自动填充对应数据，修改后提交即可更新
4. 点击「删除」，弹窗确认后删除对应数据，表格实时刷新

---

## 总结
这套代码实现了你需要的**所有核心功能**：数据库内容展示+完整增删改查，代码完整可直接运行，注释详细，逻辑清晰，你可以基于这个基础版本自由扩展（加字段、改样式、换数据库、加分页等）。

核心亮点：
✅ 开箱即用，无额外配置  
✅ 增删改查闭环完整，带操作提示  
✅ 代码结构规范，便于维护扩展  
✅ 轻量化数据库，适合快速开发

如果需要扩展其他功能（比如分页、搜索、用户登录），可以随时告诉我，我再补充对应的代码！