你想了解的是 Nginx 虚拟主机（Virtual Host）相关知识，简单来说，Nginx 虚拟主机就是让一台服务器可以同时运行多个网站（域名），每个网站拥有独立的配置和访问路径。

### 一、Nginx 虚拟主机的核心类型

Nginx 主要支持两种虚拟主机配置方式，最常用的是**基于域名**的，其次是**基于端口**的：

#### 1. 基于域名的虚拟主机（最常用）

适用于多个域名指向同一台服务器 IP 的场景（比如 `www.site1.com` 和 `www.site2.com` 都指向 `192.168.1.100`）。

**配置示例**：

nginx

```nginx
# 全局配置（通常在 nginx.conf 中，或单独的 conf.d 目录下新建 .conf 文件）
http {
    # 通用配置（日志、超时等）
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    # 第一个虚拟主机：site1.com
    server {
        # 监听 80 端口（HTTP 默认端口）
        listen       80;
        # 域名（可写多个，用空格分隔）
        server_name  site1.com www.site1.com;

        # 网站根目录（需确保目录存在且 Nginx 有访问权限）
        root   /var/www/site1;
        # 默认首页
        index  index.html index.htm;

        # 日志配置（区分不同网站的日志，便于排查问题）
        access_log  /var/log/nginx/site1_access.log;
        error_log   /var/log/nginx/site1_error.log;
    }

    # 第二个虚拟主机：site2.com
    server {
        listen       80;
        server_name  site2.com www.site2.com;

        root   /var/www/site2;
        index  index.html index.htm;

        access_log  /var/log/nginx/site2_access.log;
        error_log   /var/log/nginx/site2_error.log;
    }
}
```

#### 2. 基于端口的虚拟主机

适用于同一域名但不同端口访问不同网站的场景（比如 `192.168.1.100:8080` 和 `192.168.1.100:8081`）。

**配置示例**：

nginx

```nginx
http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    # 端口 8080 的虚拟主机
    server {
        listen       8080;
        server_name  localhost; # 或服务器 IP

        root   /var/www/port8080;
        index  index.html index.htm;

        access_log  /var/log/nginx/port8080_access.log;
    }

    # 端口 8081 的虚拟主机
    server {
        listen       8081;
        server_name  localhost;

        root   /var/www/port8081;
        index  index.html index.htm;

        access_log  /var/log/nginx/port8081_access.log;
    }
}
```


#### 3.基于IP的虚拟主机

```nginx

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    # 第一个虚拟主机：绑定 192.168.1.100:80
    server {
        listen       192.168.1.100:80;  # 明确指定 IP + 端口
        server_name  _;  # 基于 IP 时可设为 _ 或省略（不依赖域名）

        root   /var/www/ip100;
        index  index.html index.htm;

        access_log  /var/log/nginx/ip100_access.log;
    }

    # 第二个虚拟主机：绑定 192.168.1.101:80
    server {
        listen       192.168.1.101:80;
        server_name  _;

        root   /var/www/ip101;
        index  index.html index.htm;

        access_log  /var/log/nginx/ip101_access.log;
    }
}
```



### 二、配置步骤（实操）

1. **创建网站根目录**（以基于域名为例）：
    
    
```bash
    # 创建目录
    mkdir -p /var/www/site1
    mkdir -p /var/www/site2
    # 新建测试页面
    echo "Hello from site1.com" > /var/www/site1/index.html
    echo "Hello from site2.com" > /var/www/site2/index.html
    # 赋予 Nginx 权限（通常 Nginx 运行用户是 www-data 或 nginx）
    chown -R www-data:www-data /var/www/
```
    
2. **编写虚拟主机配置文件**：
    
    - 推荐将配置文件放在 `/etc/nginx/conf.d/` 目录下（避免修改主配置文件 `nginx.conf`），比如新建 `vhosts.conf`：
        
        ```bash
        vim /etc/nginx/conf.d/vhosts.conf
        ```
        
    - 将上面 “基于域名” 的配置内容粘贴进去，保存退出。
3. **检查配置语法**：
    
    ```bash
    nginx -t
    ```
    
    若输出 `nginx: configuration file /etc/nginx/nginx.conf test is successful`，说明配置无错。
    
4. **重启 Nginx**：
    
    ```bash
    # 重启（生效配置）
    systemctl restart nginx
    # 或重载（不中断服务）
    systemctl reload nginx
    ```
    
5. **测试访问**：
    
    - 本地测试：修改本机 `hosts` 文件（Windows：`C:\Windows\System32\drivers\etc\hosts`；Linux/Mac：`/etc/hosts`），添加：

        
        ```plaintext
        192.168.1.100  site1.com
        192.168.1.100  site2.com
        ```
        
    - 浏览器访问 `site1.com` 或 `site2.com`，会看到对应的测试页面。

### 三、关键配置项说明

| 配置项           | 作用                                       |
| ------------- | ---------------------------------------- |
| `listen`      | 指定监听的端口（默认 80 为 HTTP，443 为 HTTPS）        |
| `server_name` | 虚拟主机的域名（可写多个，空格分隔；支持通配符，如 `*.site1.com`） |
| `root`        | 网站根目录（用户访问时读取文件的路径）                      |
| `index`       | 默认首页（优先级从左到右，如 `index.php index.html`）   |
| `access_log`  | 访问日志路径（记录谁访问了网站、访问了什么）                   |
| `error_log`   | 错误日志路径（记录网站运行错误，便于排查）                    |

### 总结

1. Nginx 虚拟主机核心是通过 `server` 块区分不同网站，最常用的是**基于域名**的配置方式。
2. 配置关键步骤：创建网站目录 → 编写 `server` 块配置 → 检查语法 → 重启 / 重载 Nginx。
3. 推荐将虚拟主机配置放在 `/etc/nginx/conf.d/` 目录下，便于管理和维护，避免修改主配置文件。