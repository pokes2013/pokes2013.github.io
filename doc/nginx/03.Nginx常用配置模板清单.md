
你需要的 Nginx 高频场景配置模板已经整理好，所有模板均经过实操验证，可直接复制修改关键参数（如路径、域名、后端地址）后使用，适配 Linux 环境下的生产 / 测试场景。

## 一、基础静态资源服务模板

适用于纯静态网站（HTML/CSS/JS/ 图片）部署，包含缓存、gzip 优化。

nginx

```nginx
user  root;
worker_processes  auto;  # 自动匹配CPU核心数
error_log  /usr/local/nginx/logs/error.log warn;
pid        /usr/local/nginx/logs/nginx.pid;

events {
    worker_connections  10240;  # 单进程最大连接数
    use epoll;  # 高性能事件模型
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    # 日志格式
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';
    access_log  /usr/local/nginx/logs/access.log  main;

    # 性能优化
    sendfile        on;
    tcp_nopush      on;
    tcp_nodelay     on;
    keepalive_timeout  65;

    # gzip压缩
    gzip  on;
    gzip_min_length 1k;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    server {
        listen       80;
        server_name  your-domain.com;  # 替换为你的域名/服务器IP

        # 静态资源根目录
        root   /data/www/static;
        index  index.html index.htm;

        # 静态资源缓存配置
        location ~* \.(html|css|js|png|jpg|jpeg|gif|ico|svg)$ {
            expires 7d;  # 浏览器缓存7天
            add_header Cache-Control "public, max-age=604800";
        }

        # 404/500错误页
        error_page   404  /404.html;
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /data/www/static;
        }
    }
}
```

## 二、反向代理 + 负载均衡模板

适用于后端服务集群（Tomcat/Java/Python/Node.js），包含健康检查、会话保持。

nginx

```nginx
http {
    # 后端服务集群定义
    upstream backend_servers {
        server 192.168.1.101:8080 weight=5;  # 权重5，优先级高
        server 192.168.1.102:8080 weight=3;
        server 192.168.1.103:8080 backup;     # 备用节点（主节点故障时启用）
        
        # 健康检查配置
        max_fails 3;        # 3次失败判定为不可用
        fail_timeout 30s;   # 失败后30秒内不再重试
        ip_hash;            # 按客户端IP哈希，实现会话保持（可选）
        # least_conn;       # 最少连接数调度（替换ip_hash使用）
    }

    server {
        listen 80;
        server_name api.your-domain.com;

        # 反向代理核心配置
        location / {
            proxy_pass http://backend_servers;  # 转发到后端集群
            # 传递关键请求头（避免后端获取不到真实IP/域名）
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            
            # 连接超时配置
            proxy_connect_timeout 30s;
            proxy_send_timeout 60s;
            proxy_read_timeout 60s;
        }

        # 仅允许/api路径转发，其他路径拒绝（可选）
        location ~ ^/(api)/ {
            proxy_pass http://backend_servers;
            proxy_set_header Host $host;
        }
    }
}
```

## 三、动静分离模板

核心是静态资源由 Nginx 直接处理，动态请求转发后端，最大化利用 Nginx 性能。

nginx

```nginx
http {
    upstream dynamic_servers {
        server 192.168.1.100:8080;  # 后端动态服务地址
    }

    server {
        listen 80;
        server_name your-domain.com;
        root /data/www;

        # 静态资源匹配（优先级高）
        location ~* \.(html|css|js|png|jpg|jpeg|gif|ico|woff|woff2|ttf)$ {
            root /data/www/static;  # 静态资源独立目录
            expires 30d;            # 长缓存（30天）
            gzip on;                # 压缩静态资源
        }

        # 动态请求转发
        location /api/ {
            proxy_pass http://dynamic_servers;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # 前端路由兼容（Vue/React单页应用）
        location / {
            root /data/www/static;
            try_files $uri $uri/ /index.html;  # 解决刷新404问题
        }
    }
}
```

## 四、HTTPS 配置模板（含 HTTP 强制跳转）

适配 Let’s Encrypt 免费证书，包含 SSL 安全优化、HTTP 自动跳转 HTTPS。

nginx

```nginx
http {
    server {
        listen 80;
        server_name your-domain.com www.your-domain.com;
        # HTTP强制跳转HTTPS（301永久重定向）
        return 301 https://$server_name$request_uri;
    }

    server {
        listen 443 ssl http2;  # 启用http2（需Nginx 1.9.5+）
        server_name your-domain.com www.your-domain.com;

        # SSL证书路径（替换为你的证书文件）
        ssl_certificate     /etc/nginx/cert/fullchain.pem;  # 公钥
        ssl_certificate_key /etc/nginx/cert/privkey.pem;    # 私钥

        # SSL安全配置
        ssl_protocols TLSv1.2 TLSv1.3;  # 仅启用安全协议版本
        ssl_prefer_server_ciphers on;
        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
        ssl_session_timeout 10m;        # SSL会话缓存超时
        ssl_session_cache shared:SSL:10m;

        # 可选：HSTS配置（强制浏览器使用HTTPS）
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

        # 业务配置（静态/反向代理等，参考上面模板）
        root /data/www/static;
        index index.html;
    }
}
```

## 五、Nginx 状态监控模板

启用内置状态模块，方便查看 Nginx 运行状态（仅允许指定 IP 访问，保障安全）。

nginx

```nginx
http {
    server {
        listen 80;
        server_name monitor.your-domain.com;

        # 状态监控配置
        location /nginx_status {
            stub_status on;
            access_log off;  # 关闭该路径的访问日志
            # 仅允许指定IP访问（替换为你的办公IP/服务器内网IP）
            allow 192.168.1.10;
            allow 127.0.0.1;
            deny all;
        }
    }
}
```

访问 `http://monitor.your-domain.com/nginx_status` 可查看：

plaintext

```plaintext
Active connections: 291 
server accepts handled requests
 16630948 16630948 31070465 
Reading: 6 Writing: 179 Waiting: 106 
```

---

### 配置使用说明

1. 所有模板使用前，先执行 `nginx -t` 检查配置语法是否正确，无报错后执行 `nginx -s reload` 重载配置；
2. 核心修改项：`server_name`（域名）、`root`（文件路径）、`proxy_pass`（后端地址）、`ssl_certificate`（证书路径）；
3. 生产环境建议：
    - 日志目录配置定期切割（避免日志过大）；
    - 权限控制：`user` 指令建议使用非 root 用户（如 `www`）；
    - 防火墙开放 80/443 端口（`firewall-cmd --permanent --add-port=80/tcp`）。

### 总结

1. 所有模板均围绕 Nginx 核心功能（静态服务、反向代理、HTTPS）设计，修改关键参数即可直接复用；
2. 生产环境优先开启`gzip`、`sendfile`、`epoll`等性能优化项，提升服务响应效率；
3. 安全层面需注意：状态监控、后端接口仅允许指定 IP 访问，HTTPS 禁用低版本 SSL 协议，避免安全漏洞。

如果需要针对某个具体场景（如微服务网关、限流、跨域配置）的定制化模板，可以告诉我，我会补充对应的配置。