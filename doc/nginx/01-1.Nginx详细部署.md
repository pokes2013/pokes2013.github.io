你想要了解的是 Nginx 的详细部署流程，我会从环境准备、安装、配置、启动验证到日常管理，为你提供一套完整且可落地的部署指南，适用于主流的 Linux 系统（以 CentOS 7/8 或 Ubuntu 20.04/22.04 为例）。

## 一、部署前准备

### 1. 系统环境检查

首先确保服务器网络正常，且没有占用 80/443 端口的服务（如 Apache），可通过以下命令检查：


```bash
# 检查端口占用
netstat -tulpn | grep -E '80|443'
# 若有占用，停止对应服务（以 Apache 为例）
systemctl stop httpd && systemctl disable httpd
```

### 2. 安装依赖（必做）

Nginx 编译安装需要依赖编译器和相关库，先安装依赖包：

#### CentOS/RHEL 系统

```bash
yum install -y gcc gcc-c++ make pcre pcre-devel zlib zlib-devel openssl openssl-devel wget
```

#### Ubuntu/Debian 系统


```bash
apt update && apt install -y gcc g++ make libpcre3 libpcre3-dev zlib1g zlib1g-dev libssl-dev wget
```

## 二、Nginx安装

### 包管理器安装（简单快捷，推荐新手）

#### CentOS/RHEL 系统

1. 添加 Nginx 官方源：


```bash
# CentOS 7
wget -O /etc/yum.repos.d/nginx.repo https://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
# CentOS 8
wget -O /etc/yum.repos.d/nginx.repo https://nginx.org/packages/centos/8/noarch/RPMS/nginx-release-centos-8-0.el8.ngx.noarch.rpm
```

2. 安装 Nginx：

```bash
yum install -y nginx
```

#### Ubuntu/Debian 系统

1. 添加 Nginx 官方源：


```bash
# 安装证书和依赖
apt install -y gnupg2 ca-certificates lsb-release
# 添加 Nginx 密钥
wget -O - http://nginx.org/keys/nginx_signing.key | apt-key add -
# 添加源
echo "deb http://nginx.org/packages/ubuntu $(lsb_release -cs) nginx" > /etc/apt/sources.list.d/nginx.list
```

2. 安装 Nginx：


```bash
apt update && apt install -y nginx
```

### 源码安装

请看文档中的：[[01-2.源码部署Nginx]]

## 三、核心配置（重点）

Nginx 的主配置文件路径：

- 包管理器安装：`/etc/nginx/nginx.conf`
- 编译安装：`/usr/local/nginx/conf/nginx.conf`

### 1. 主配置文件基础模板（简化版，适合新手）


```nginx
# 全局配置
user  nginx;        # 运行用户
worker_processes  auto;  # 工作进程数，auto 为 CPU 核心数
error_log  /var/log/nginx/error.log warn;  # 错误日志
pid        /var/run/nginx.pid;  # 进程 PID 文件

# 工作模式配置
events {
    worker_connections  1024;  # 每个进程最大连接数
    use epoll;  # 高效的事件模型（Linux 推荐）
}

# HTTP 核心配置
http {
    include       /etc/nginx/mime.types;  # 媒体类型映射
    default_type  application/octet-stream;

    # 日志格式
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';
    access_log  /var/log/nginx/access.log  main;  # 访问日志

    sendfile        on;  # 开启高效文件传输
    tcp_nopush      on;  # 减少网络报文段数量
    tcp_nodelay     on;
    keepalive_timeout  65;  # 长连接超时时间

    gzip  on;  # 开启 Gzip 压缩
    gzip_min_length 1k;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # 引入虚拟主机配置（推荐将站点配置单独拆分）
    include /etc/nginx/conf.d/*.conf;
}
```

### 2. 虚拟主机配置（站点配置）

新建站点配置文件（以部署静态网站为例）：

- 包管理器安装：`/etc/nginx/conf.d/default.conf`
- 编译安装：`/usr/local/nginx/conf/conf.d/default.conf`


```nginx
server {
    listen       80;  # 监听 80 端口
    server_name  localhost;  # 域名，可改为你的域名（如 www.example.com）
    root   /usr/share/nginx/html;  # 网站根目录
    index  index.html index.htm;  # 默认首页

    # 访问权限
    location / {
        try_files $uri $uri/ =404;  # 尝试访问文件/目录，不存在返回 404
    }

    # 错误页面配置
    error_page  404              /404.html;
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
```

## 四、启动与验证

### 1. 配置检查（必做，避免启动失败）


```bash
# 包管理器安装
nginx -t
# 编译安装
/usr/local/nginx/sbin/nginx -t
# 成功提示：nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
#          nginx: configuration file /etc/nginx/nginx.conf test is successful
```

### 2. 启动 Nginx


```bash
# 包管理器安装（系统服务）
systemctl start nginx
systemctl enable nginx  # 设置开机自启

# 编译安装（手动启动）
/usr/local/nginx/sbin/nginx
# 开机自启：将启动命令添加到 /etc/rc.d/rc.local，并赋予执行权限
chmod +x /etc/rc.d/rc.local
echo "/usr/local/nginx/sbin/nginx" >> /etc/rc.d/rc.local
```

### 3. 验证是否运行


```bash
# 检查进程
ps -ef | grep nginx
# 检查端口
netstat -tulpn | grep nginx
# 访问测试（本地/远程）
curl http://localhost  # 本地访问
# 或在浏览器输入服务器 IP，能看到 Nginx 默认页面即成功
```

## 五、日常管理命令



```bash
# 包管理器安装（推荐）
systemctl status nginx  # 查看状态
systemctl restart nginx # 重启（配置修改后生效）
systemctl reload nginx  # 平滑重启（不中断服务）
systemctl stop nginx    # 停止

# 编译安装
/usr/local/nginx/sbin/nginx -s reload  # 平滑重启
/usr/local/nginx/sbin/nginx -s stop    # 停止
/usr/local/nginx/sbin/nginx -s quit    # 优雅退出
```

## 六、常见优化（可选）

1. 调整文件描述符限制：修改 `/etc/security/limits.conf`，添加：


```plaintext
nginx soft nofile 65535
nginx hard nofile 65535
```

2. 开启 TCP 快速回收：修改 `/etc/sysctl.conf`，添加：


```plaintext
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_tw_reuse = 1
```

执行 `sysctl -p` 生效。

### 总结

1. Nginx 部署核心步骤：环境准备 → 安装（包管理器 / 编译）→ 配置（主配置 + 站点配置）→ 启动验证，其中**配置检查**是避免启动失败的关键。
2. 新手优先用**包管理器安装**，操作简单且便于系统管理；进阶场景可选择编译安装，自定义模块。
3. 日常管理重点：修改配置后需先执行 `nginx -t` 检查语法，再用 `reload` 平滑重启，避免服务中断。