Nginx 是高性能的 HTTP 和反向代理服务器，也是 IMAP/POP3/SMTP 代理服务器，在 Linux 运维、网站架构中应用广泛。以下是**从基础到进阶**的系统化学习路线，兼顾理论和实践，适配 Linux 运维从业者的学习需求。

## 一、 基础入门阶段（搭建认知 + 环境部署）

### 1. 核心认知

- 了解 Nginx 的定位：轻量级、高并发、低内存占用的特点，对比 Apache 的差异（异步非阻塞 vs 多进程 / 多线程）。
- 掌握核心功能：静态资源服务、反向代理、负载均衡、动静分离、虚拟主机。
- 熟悉应用场景：网站前端静态资源部署、API 网关、反向代理后端服务（Java/Python/Node.js）。

### 2. 环境部署（Linux 实操）

- **源码编译安装**（重点）：
    - 依赖安装：`gcc` `pcre-devel` `zlib-devel` `openssl-devel`。
    - 编译参数配置：`--prefix`（安装路径）、`--with-http_ssl_module`（SSL 模块）、`--with-http_stub_status_module`（状态监控）等常用模块。
    - 启动 / 停止 / 重载命令：`nginx` `nginx -s stop/quit/reload`。
- **包管理器安装**（快速测试）：`yum install nginx`（CentOS）、`apt install nginx`（Ubuntu）。
- 验证部署：访问服务器 IP，查看 Nginx 默认欢迎页。

### 3. 核心配置文件解析

- 主配置文件结构：`/usr/local/nginx/conf/nginx.conf`（源码安装路径）
    - 全局块：`worker_processes`（工作进程数，建议等于 CPU 核心数）、`error_log`（错误日志路径）。
    - `events` 块：`worker_connections`（单个工作进程最大连接数）、`use epoll`（高性能事件模型）。
    - `http` 块：包含 `server` 块、`upstream` 块，是配置的核心。
- 第一个静态资源服务配置：将本地 HTML 文件部署到 Nginx，通过浏览器访问。
## 二、 核心功能进阶（运维高频场景）

### 1. 虚拟主机配置

- **基于域名的虚拟主机**（最常用）：配置多个 `server` 块，通过 `server_name` 区分不同域名。
- **基于端口的虚拟主机**：同一域名不同端口，通过 `listen` 端口号区分。
- **基于 IP 的虚拟主机**：服务器绑定多个 IP，每个 IP 对应一个 `server` 块。

### 2. 反向代理与负载均衡

- **反向代理**：将客户端请求转发到后端应用服务器（如 Tomcat、Node.js）。
    
    nginx
    
    ```nginx
    location / {
      proxy_pass http://127.0.0.1:8080;  # 后端服务地址
      proxy_set_header Host $host;       # 传递请求头
    }
    ```
    
- **负载均衡**：通过 `upstream` 模块实现多台后端服务器的请求分发。
    - 调度算法：
        - 轮询（默认）：请求按顺序分发。
        - 加权轮询：`weight` 参数，权重越高分配的请求越多。
        - `ip_hash`：按客户端 IP 哈希，解决会话保持问题。
        - 最少连接：`least_conn`，优先分发到连接数最少的服务器。
    - 健康检查：`max_fails` `fail_timeout`，自动剔除故障节点。

### 3. 动静分离

- 核心思想：静态资源（HTML/CSS/JS/ 图片）由 Nginx 直接处理，动态请求转发到后端。
    
    nginx
    
    ```nginx
    # 静态资源匹配
    location ~* \.(html|css|js|png|jpg)$ {
      root /usr/local/nginx/html;  # 静态资源根目录
      expires 7d;  # 浏览器缓存 7 天
    }
    # 动态请求转发
    location /api/ {
      proxy_pass http://backend_server;
    }
    ```
    

### 4. HTTPS 配置（SSL/TLS 证书）

- 申请免费证书：Let’s Encrypt（`certbot` 工具自动申请）。
- 配置 SSL 模块：
    
    nginx
    
    ```nginx
    server {
      listen 443 ssl;
      server_name example.com;
      ssl_certificate /path/cert.pem;  # 证书文件
      ssl_certificate_key /path/key.pem;  # 私钥文件
      ssl_protocols TLSv1.2 TLSv1.3;  # 安全协议版本
    }
    ```
    
- 强制 HTTP 跳转 HTTPS：通过 80 端口的 `server` 块配置 301 重定向。

## 三、 高级运维与性能优化

### 1. 性能调优

- **内核参数优化**（Linux 层面）：
    - 修改 `/etc/sysctl.conf`：调整 `net.core.somaxconn`（最大监听队列长度）、`net.ipv4.tcp_tw_reuse`（复用 TIME_WAIT 连接）等。
- **Nginx 配置调优**：
    - `worker_processes` = CPU 核心数，`worker_connections` 调至最大（受限于系统文件描述符）。
    - 启用 `gzip` 压缩：减小传输体积，`gzip on;` `gzip_types text/plain application/json;`。
    - 开启 `sendfile on;`：零拷贝传输，提升静态资源传输效率。

### 2. 日志管理

- 访问日志配置：`access_log` 路径 + 日志格式（`$remote_addr` `$request_uri` `$status` 等变量）。
- 日志切割：Nginx 不自带切割功能，需通过 Shell 脚本 + `crontab` 定时切割（避免日志文件过大）。
- 日志分析：使用 `awk` `grep` 分析访问量、状态码、热门接口；或接入 ELK 栈（Elasticsearch + Logstash + Kibana）可视化分析。

### 3. 监控与故障排查

- **内置状态监控**：启用 `stub_status` 模块，查看连接状态（活跃连接、请求数等）。
    
    nginx
    
    ```nginx
    location /nginx_status {
      stub_status on;
      allow 127.0.0.1;  # 仅允许本地访问
      deny all;
    }
    ```
    
- **第三方监控工具**：
    - Zabbix/Prometheus + Grafana：监控 Nginx 进程状态、连接数、响应时间。
    - 开源工具：`ngxtop`（实时日志分析工具）。
- **故障排查思路**：
    - 查看错误日志：`tail -f /usr/local/nginx/logs/error.log`。
    - 配置语法检查：`nginx -t`（启动前必做）。
    - 网络排查：`curl` `telnet` 测试端口连通性。

## 四、 模块化扩展与实战部署

### 1. 常用第三方模块

- `ngx_http_substitutions_filter_module`：内容替换（替换页面中的指定字符串）。
- `ngx_http_geoip_module`：基于 IP 地址的地域限制。
- `lua-nginx-module`（OpenResty）：嵌入 Lua 脚本，实现复杂业务逻辑（如限流、鉴权）。

### 2. 实战部署场景

- **前后端分离项目部署**：Nginx 部署前端静态资源 + 反向代理后端 API。
- **微服务网关**：结合 OpenResty 实现接口鉴权、限流、熔断。
- **高可用架构**：Nginx + Keepalived 实现双机热备（避免单点故障）。

## 五、 学习资源与实践建议

### 1. 优质资源

- **官方文档**：[Nginx 官方文档](http://nginx.org/en/docs/)（权威，覆盖所有模块）。
- **书籍**：《深入理解 Nginx：模块开发与架构解析》（进阶必备）、《Nginx 实战》（入门实操）。
- **视频教程**：B 站搜索 “Nginx 运维实战”，选择 Linux 环境下的实操教程。

### 2. 实践建议

- 搭建本地 Linux 虚拟机（VMware/VirtualBox），所有配置手动敲一遍，避免复制粘贴。
- 尝试搭建完整架构：`Nginx + Tomcat 集群 + MySQL`，实现负载均衡 + 动静分离。
- 把学习过程中的配置和排错经验整理到个人知识库（如 Obsidian），形成自己的 Nginx 运维手册。