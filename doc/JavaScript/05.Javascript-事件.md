# JavaScript 事件相关知识整理

## 一、事件基础概念

事件是编程语言中描述程序行为或状态的术语，**当行为或状态发生改变时，会立即调用一个函数**。

- 示例：用户鼠标点击网页按钮、鼠标拖拽网页图片等操作。

## 二、事件监听

结合 DOM 使用事件时，需为 DOM 对象添加事件监听，等待事件触发后执行对应函数。

### 1. 核心方法

`addEventListener`：DOM 对象添加事件监听的专用方法，接收两个参数：

- 事件类型：指定监听的事件（如点击、双击等）；
- 事件回调：事件触发后执行的函数。

### 2. 实现步骤

1. 获取目标 DOM 元素；
2. 调用 `addEventListener` 方法绑定事件类型和回调函数；
3. 等待事件触发（如用户点击按钮）；
4. 事件触发后，执行回调函数。

### 3. 通俗理解

事件本质是 “找一个触发时机（事件触发），调用对应的函数（回调函数）”。

### 4. 代码示例（点击事件）

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>事件监听</title>
</head>
<body>
  <h3>事件监听</h3>
  <p id="text">为 DOM 元素添加事件监听，等待事件发生，便立即执行一个函数。</p>
  <button id="btn">点击改变文字颜色</button>
  <script>
    // 1. 获取 DOM 元素
    const btn = document.querySelector('#btn')
    // 2. 添加事件监听
    btn.addEventListener('click', function () {
      console.log('等待事件被触发...')
      // 3. 事件触发后执行的逻辑
      let text = document.getElementById('text')
      text.style.color = 'red'
    })
  </script>
</body>
</html>
```

## 三、事件核心组成

### 1. 事件类型

决定事件的触发方式，主要分类及常用类型如下：

|    事件分类     |   常用类型   |          说明          |
| :-------------: | :----------: | :--------------------: |
|    鼠标事件     |   `click`    |      鼠标单击触发      |
|                 |  `dblclick`  |      鼠标双击触发      |
|                 | `mouseenter` | 鼠标移入 DOM 元素触发  |
|                 | `mouseleave` | 鼠标移出 DOM 元素触发  |
|    键盘事件     |  `keydown`   |      键盘按下触发      |
|                 |   `keyup`    |      键盘抬起触发      |
|    焦点事件     |   `focus`    |  DOM 元素获得焦点触发  |
|                 |    `blur`    |  DOM 元素失去焦点触发  |
| 表单 / 输入事件 |   `input`    |  文本框输入内容时触发  |
|                 |   `change`   | 元素内容发生变化时触发 |

#### 代码示例（双击 / 鼠标移入移出事件）

```html
<!-- 双击事件 -->
<script>
  btn.addEventListener('dblclick', function () {
    console.log('双击事件触发...');
    const text = document.querySelector('.text')
    text.style.color = 'red'
    text.style.fontSize = '20px'
  })
</script>

<!-- 鼠标移入/移出事件 -->
<body>
  <h3>鼠标事件</h3>
  <p>监听与鼠标相关的操作</p>
  <hr>
  <div class="box"></div>
  <script>
    const box = document.querySelector('.box');
    // 鼠标移入
    box.addEventListener('mouseenter', function () {
      this.innerText = '鼠标移入了...';
      this.style.cursor = 'move';
    })
    // 鼠标移出
    box.addEventListener('mouseleave', function () {
      this.innerText = '鼠标移出了...';
    })
  </script>
</body>
```

### 2. 事件处理程序

即 `addEventListener` 的第二个参数（函数），定义事件触发后执行的逻辑（如修改 DOM 样式、内容等）。

## 四、事件对象

事件触发时，与事件相关的信息会以对象形式记录，称为事件对象。

### 1. 获取方式

事件回调函数的**第一个参数**即为事件对象，常用命名：`event`、`ev`、`e`；也可通过 `window.event` 获取。

### 2. 常用属性

|      属性      |                      说明                      |
| :------------: | :--------------------------------------------: |
|   `ev.type`    | 获取当前事件的类型（如 `click`、`mouseenter`） |
| `ev.clientX/Y` |           光标相对于浏览器窗口的位置           |
| `ev.offsetX/Y` |         光标相对于当前 DOM 元素的位置          |
|    `ev.key`    |               获取按下的键盘按键               |

### 3. 代码示例

```html
<body>
  <h3>事件对象</h3>
  <div class="box"></div>
  <script>
    const box = document.querySelector('.box')
    box.addEventListener('click', function (e) {
      console.log('事件类型：', e.type); // 输出 "click"
      console.log('光标相对窗口位置：', e.clientX, e.clientY);
      console.log('光标相对当前元素位置：', e.offsetX, e.offsetY);
    })
  </script>
</body>
```

## 五、环境对象（this）

### 1. 概念

函数内部的特殊变量 `this`，代表函数运行时所处的环境（即 “谁调用函数，`this` 就指向谁”）。

### 2. 核心规则

|           函数调用方式            |        `this` 指向        |
| :-------------------------------: | :-----------------------: |
|       直接调用（如 `fn()`）       | `window`（默认全局对象）  |
| 作为对象方法调用（如 `obj.fn()`） | 调用该方法的对象（`obj`） |

### 3. 代码示例

```html
<script>
  // 声明函数
  function sayHi() {
    console.log(this);
  }
  // 声明对象
  let user = {
    name: '张三',
    sayHi: sayHi
  }
  let person = {
    name: '李四',
    sayHi: sayHi
  }
  // 直接调用：this 指向 window
  sayHi() // window
  window.sayHi() // window
  // 作为对象方法调用：this 指向调用对象
  user.sayHi() // user 对象
  person.sayHi() // person 对象
</script>
```

### 4. 关键结论

- `this` 是对象类型的变量；
- 函数调用方式不同，`this` 的值不同；
- 直接调用函数等价于 `window.函数名()`，故 `this` 指向 `window`。