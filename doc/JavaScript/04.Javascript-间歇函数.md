

## 间歇函数

> 知道间歇函数的作用，利用间歇函数创建定时任务。

`setInterval` 是 JavaScript 中内置的函数，它的作用是间隔固定的时间自动重复执行另一个函数，也叫定时器函数。

`setInterval` 用于按照指定的时间间隔（毫秒）重复执行一段代码，它会返回一个唯一的 ID，用于后续通过 `clearInterval` 停止这个间歇执行。



### 示例1：基础用法（定时打印）

这是最基础的用法，每隔 1 秒在控制台打印一次文本，5 秒后停止执行。

```javascript
// 定义间歇函数，返回的timerId用于停止执行
const timerId = setInterval(() => {
  console.log("这是每秒执行一次的间歇函数");
}, 1000); // 1000毫秒 = 1秒

// 5秒后停止间歇函数
setTimeout(() => {
  clearInterval(timerId);
  console.log("间歇函数已停止");
}, 5000);
```

代码解释：

- setInterval 第一个参数是要执行的函数，第二个参数是执行间隔（毫秒）。
- timerId 是间歇函数的唯一标识，传给 clearInterval 就能停止执行。
- 用 setTimeout 模拟 5 秒后手动停止间歇函数，避免无限执行。

### 示例2：实时更新页面时钟

实用场景：在页面上显示实时更新的当前时间，每秒刷新一次。

```javascript
<!DOCTYPE html>
<html>
<body>
  <h1>当前时间：<span id="clock"></span></h1>

  <script>
    // 获取显示时间的DOM元素
    const clockElement = document.getElementById('clock');

    // 定义更新时间的函数
    function updateClock() {
      const now = new Date();
      // 格式化时间：时:分:秒（补零保证两位数）
      const timeStr = now.toLocaleTimeString('zh-CN', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      clockElement.textContent = timeStr;
    }

    // 立即执行一次，避免页面加载后延迟显示
    updateClock();
    // 每隔1秒更新一次时间
    setInterval(updateClock, 1000);
  </script>
</body>
</html>
```

### 示例3：没有清除则会永远执行下去

```javascript
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>定时器页面输出</title>
</head>
<body>
<h1>定时器效果</h1>
<div id="output"></div>

<script>
  // 1. 第一个定时器 - 会一直运行
  let timer1 = setInterval(function() {
    document.body.innerHTML += '<p>定时器1: 不知疲倦的执行下去....</p>';
  }, 1000);

  // 2. 第二个定时器 - 只会运行5秒
  let timer2 = setInterval(function() {
    document.body.innerHTML += '<p style="color: red;">定时器2: hi</p>';
  }, 2000);

  // 5秒后清除第二个定时器
  setTimeout(function() {
    clearInterval(timer2);
    document.body.innerHTML += '<h3>定时器2已停止，但定时器1还在运行</h3>';
  }, 5000);
</script>
</body>
</html>
```

效果如下：

![image-20260121134741998](./04.Javascript-间歇函数.assets/image-20260121134741998.png)

### 示例4：执行指定次数后停止

场景：需要重复执行，但不是无限次，而是指定次数后停止。

```javascript
// 初始化计数器
let count = 0;
// 定义最大执行次数
const maxCount = 5;

// 创建间歇函数
const intervalId = setInterval(() => {
  count++;
  console.log(`第 ${count} 次执行`);

  // 达到最大次数时停止
  if (count === maxCount) {
    clearInterval(intervalId);
    console.log(`已执行 ${maxCount} 次，间歇函数停止`);
  }
}, 1000);
```

**代码解释**：

- 通过计数器 `count` 记录执行次数，每次执行后自增。
- 每次执行时判断是否达到最大次数，达到则调用 `clearInterval` 停止。

### 示例5：动态修改间歇函数的执行间隔

```javascript
let intervalId;
// 初始间隔：2秒
let intervalTime = 2000;
let runTimes = 0;

// 定义执行函数
function doSomething() {
  runTimes++;
  console.log(`第 ${runTimes} 次执行，当前间隔：${intervalTime/1000}秒`);

  // 执行3次后，将间隔改为1秒
  if (runTimes === 3) {
    // 先停止原有间歇函数
    clearInterval(intervalId);
    // 修改间隔时间
    intervalTime = 1000;
    // 重新创建间歇函数
    intervalId = setInterval(doSomething, intervalTime);
  }

  // 执行6次后停止
  if (runTimes === 6) {
    clearInterval(intervalId);
    console.log("执行结束");
  }
}

// 启动初始间歇函数
intervalId = setInterval(doSomething, intervalTime);
```

**代码解释**：

- `setInterval` 本身无法直接修改间隔，需先通过 `clearInterval` 停止，再重新创建。
- 示例中前 3 次每 2 秒执行一次，3 次后改为每 1 秒执行一次，总共执行 6 次后停止。

### 总结

1. `setInterval(fn, time)` 用于按固定间隔重复执行代码，返回的 ID 是停止它的关键。
2. 停止间歇函数必须用 `clearInterval(intervalId)`，否则会无限执行，可能导致性能问题。
3. 如需修改执行间隔，需先停止原有间歇函数，再重新创建（无法直接修改）。
4. 实际开发中建议给间歇函数设置停止条件（如计数器、时间阈值），避免无限执行。
