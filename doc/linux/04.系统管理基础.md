04.系统管理基础

## 一、系统基础与登录

### 1. 系统启动流程（以 CentOS 7/8 为例）

1. **BIOS/UEFI 初始化** ：硬件自检，加载引导程序（GRUB2）
2. **GRUB2 引导** ：选择内核版本，加载 `vmlinuz`（内核镜像）和 `initramfs`（临时根文件系统）
3. **内核初始化** ：检测硬件、挂载根分区，启动 `systemd`（系统一号进程）
4. **运行级别初始化** ：`systemd`通过 `target`（替代传统 `runlevel`）启动对应服务，常见 `target`：

* `multi-user.target`：多用户命令行模式（默认）
* `graphical.target`：图形界面模式
* `rescue.target`：救援模式

### 2. 远程登录与终端操作

* **SSH 登录** ：`ssh 用户名@服务器IP -p 端口`（默认端口 22），例如 `ssh root@192.168.1.100`
* **终端快捷键** ：
* `Ctrl+Alt+T`：打开新终端（图形界面）
* `Ctrl+C`：终止当前命令
* `Ctrl+D`：退出当前终端 / 会话
* `Tab`：命令 / 路径自动补全

## 二、用户与权限管理

### 1. 用户 / 组基础

Linux 是**多用户多任务**系统，用户分为三类：

* **root 用户** ：UID=0，系统超级管理员，拥有最高权限
* **系统用户** ：UID 1-999，用于运行系统服务（如 `nginx`、`mysql`用户）
* **普通用户** ：UID≥1000，由 root 创建的普通账号

### 2. 核心命令

| 功能         | 命令示例                           | 说明                                                 |
| ------------ | ---------------------------------- | ---------------------------------------------------- |
| 创建用户     | `useradd testuser`               | 新建 `testuser`用户，默认家目录 `/home/testuser` |
| 设置密码     | `passwd testuser`                | 为 `testuser`设置登录密码                          |
| 创建用户组   | `groupadd testgroup`             | 新建 `testgroup`组                                 |
| 把用户加入组 | `usermod -aG testgroup testuser` | `-a`为追加，`-G`指定附加组                       |
| 切换用户     | `su - testuser`                  | 切换到 `testuser`并加载其环境变量                  |
| 删除用户     | `userdel -r testuser`            | `-r`同时删除家目录                                 |

### 3. 文件权限控制

Linux 文件权限分为 **所有者（u）、所属组（g）、其他用户（o）** ，权限类型：

* **读（r）** ：4，可查看文件内容 / 列出目录文件
* **写（w）** ：2，可修改文件 / 在目录创建删除文件
* **执行（x）** ：1，可运行程序 / 进入目录

#### 权限查看与修改

* 查看权限：`ls -l 文件名`，例如 `-rw-r--r-- 1 root root 0 10月 1 10:00 test.txt`，表示：
  * 所有者（root）：读写（rw-）
  * 所属组（root）：只读（r--）
  * 其他用户：只读（r--）
* 修改权限：`chmod`，例如 `chmod 755 test.sh`（所有者 rwx，组和其他 rx）；也可使用符号模式 `chmod u+x test.sh`（给所有者加执行权限）
* 修改所有者：`chown root:testgroup test.txt`（改为 root 所有，testgroup 组）

## 三、文件系统与磁盘管理

### 1. 目录结构（FHS 标准）

Linux 采用 **单根目录结构** ，核心目录含义：

* `/`：根目录，所有文件的起点
* `/bin`/`/sbin`：系统命令（`sbin`为管理员命令）
* `/etc`：系统配置文件目录（如 `/etc/ssh/sshd_config`、`/etc/fstab`）
* `/home`：普通用户家目录
* `/var`：可变数据目录（日志、数据库、邮件等）
* `/tmp`：临时文件目录（重启后清空）
* `/proc`：内存虚拟文件系统，存储系统进程和内核信息（非磁盘文件）

### 2. 磁盘管理命令

| 功能         | 命令                          | 说明                                                                      |
| ------------ | ----------------------------- | ------------------------------------------------------------------------- |
| 查看磁盘分区 | `lsblk`/`fdisk -l`        | `lsblk`更直观，`fdisk -l`显示分区详情                                 |
| 挂载分区     | `mount /dev/sdb1 /mnt/data` | 将 `sdb1`分区挂载到 `/mnt/data`                                       |
| 开机自动挂载 | 编辑 `/etc/fstab`           | 添加 `/dev/sdb1 /mnt/data ext4 defaults 0 0`（需执行 `mount -a`生效） |
| 查看磁盘使用 | `df -h`                     | `-h`以人类可读单位显示（GB/MB）                                         |
| 查看目录大小 | `du -sh /var/log`           | `-s`汇总大小，`-h`友好显示                                            |

## 四、服务与进程管理

### 1. systemd 服务管理（CentOS7+）

`systemd`是 Linux 系统的初始化和服务管理工具，核心命令 `systemctl`：

| 操作         | 命令示例                    | 说明                                      |
| ------------ | --------------------------- | ----------------------------------------- |
| 启动服务     | `systemctl start nginx`   | 启动 nginx 服务                           |
| 开机自启     | `systemctl enable nginx`  | 设置 nginx 开机自动启动                   |
| 查看状态     | `systemctl status nginx`  | 查看服务运行状态（active/running 为正常） |
| 重启服务     | `systemctl restart nginx` | 重启服务（配置修改后生效）                |
| 停止服务     | `systemctl stop nginx`    | 停止服务                                  |
| 禁止开机自启 | `systemctl disable nginx` | 取消开机自启                              |

### 2. 进程管理

* **查看进程** ：
* `ps aux`：查看所有进程（`a`所有用户，`u`显示用户，`x`无终端进程）
* `top`：实时监控进程资源占用（按 `q`退出）
* **终止进程** ：
* `kill 进程PID`：终止指定 PID 进程（如 `kill 1234`）
* `killall nginx`：终止所有 nginx 进程（按进程名）

## 五、系统监控与日志

### 1. 资源监控

* **CPU / 内存监控** ：`top`/`htop`（需安装），`top`中 `%Cpu`列显示 CPU 占用，`%MEM`列显示内存占用
* **网络监控** ：`iftop`（需安装，监控带宽）、`netstat -tulnp`（查看端口占用，`t`TCP，`u`UDP，`l`监听，`p`进程）

### 2. 日志管理

Linux 默认日志存储在 `/var/log`，核心日志文件：

* `/var/log/messages`：系统通用日志（内核、服务等）
* `/var/log/secure`：安全日志（SSH 登录、sudo 操作等）
* `/var/log/nginx/access.log`：nginx 访问日志（应用日志）
* 查看日志命令：`tail -f /var/log/messages`（`-f`实时跟踪日志更新）
