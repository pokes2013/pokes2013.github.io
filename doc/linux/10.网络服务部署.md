# 常用Linux服务部署实操指南




- [Apache]()

- [Tomcat（Java 服务部署）]()

- [FTP/SFTP服务](./)

- [samba文件共享](./10.网络服务部署子项/10.2-AlmaLinux9安装Samba虚拟用户配置.md)

- [Linux网络服务部署故障排查清单](./10.网络服务部署子项/10.1-Linux网络服务部署故障排查清单)



# Linux 网络服务部署实操指南

Linux 作为服务器操作系统，常需部署各类网络服务以满足业务需求。以下是**最常用的 6 类网络服务**的标准化部署流程，涵盖基础配置、命令实操和故障排查，适配 CentOS/RHEL 7/8/9 及 Ubuntu 20.04/22.04 系统。

## 一、基础前置准备

在部署任何网络服务前，需完成以下基础配置，避免权限、防火墙等问题：

### 关闭/配置防火墙

CentOS/RHEL 系统：

```bash
 # 临时关闭 firewalld（测试环境）
 systemctl stop firewalld && systemctl disable firewalld
 # 生产环境开放端口（例如 80/443）
 firewall-cmd --add-port=80/tcp --permanent
 firewall-cmd --reload
```
Ubuntu系统：
```bash
 # 关闭 ufw（测试环境）
ufw disable
 # 生产环境开放端口
 ufw allow 80/tcp
```
### 关闭SELinux

（仅 CentOS/RHEL 系统）

```bash
# 临时关闭
setenforce 0
# 永久关闭（修改配置文件）
sed -i 's/^SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
```

### 配置主机名与DNS

```bash
# 设置主机名
hostnamectl set-hostname server-node1
# 配置 DNS（国内推荐阿里云 DNS）
echo "nameserver 223.5.5.5" >> /etc/resolv.conf
```

## 二、1. HTTP 服务（Nginx）

Nginx 是高性能的 HTTP 反向代理和静态资源服务器，常用于网站部署。

### 部署步骤

安装Nginx

CentOS/RHEL系统：

```bash
# 安装 EPEL 源
yum install -y epel-release
yum install -y nginx
```
Ubuntu系统：

```bash
apt update && apt install -y nginx
```

3. **启动并设置开机自启**

```bash
systemctl start nginx
systemctl enable nginx
```

4. **配置静态网站**

 编辑配置文件：`vim /etc/nginx/conf.d/default.conf`

 ```nginx
 server {
     listen 80;
     server_name localhost;
     root /usr/share/nginx/html;  # 网站根目录
     index index.html index.htm;

     # 日志配置
     access_log /var/log/nginx/access.log;
     error_log /var/log/nginx/error.log;
 }
 ```
编写测试页面：

 ```bash
 echo "<h1>Hello Nginx on Linux</h1>" > /usr/share/nginx/html/index.html
 ```

5. **验证访问**

浏览器访问 `http://服务器IP`，即可看到测试页面。

## 三、2. FTP 服务（vsftpd）

vsftpd 是 Linux 主流 FTP 服务，用于文件上传下载，支持匿名和本地用户模式。

### 部署步骤

1. **安装 vsftpd**

   * CentOS/RHEL：`yum install -y vsftpd`
   * Ubuntu：`apt install -y vsftpd`
2. **配置 vsftpd**
   编辑配置文件：`vim /etc/vsftpd/vsftpd.conf`ini

   ```ini
   anonymous_enable=NO  # 禁止匿名访问
   local_enable=YES     # 允许本地用户访问
   write_enable=YES     # 允许写入
   local_umask=022      # 本地文件权限掩码
   chroot_local_user=YES  # 限制用户在家目录（防止越权）
   allow_writeable_chroot=YES  # 允许家目录可写
   ```
3. **创建 FTP 用户**
   bash

   运行

   ```bash
   useradd -m ftpuser
   passwd ftpuser  # 设置密码
   ```
4. **启动服务并验证**
   bash

   运行

   ```bash
   systemctl start vsftpd
   systemctl enable vsftpd
   # 测试连接（本地）
   ftp 127.0.0.1  # 输入 ftpuser 和密码
   ```

## 四、3. DNS 服务（Bind9）

Bind9 是开源 DNS 服务器，用于域名解析，适用于内网域名管理。

### 部署步骤（Ubuntu 为例，CentOS 类似）

1. **安装 Bind9**
   
   ```bash
   apt update && apt install -y bind9 bind9utils bind9-doc
   ```
2. **配置主配置文件**
   编辑 `/etc/bind/named.conf.options`：

   ```conf
   options {
       directory "/var/cache/bind";
       forwarders { 223.5.5.5; 114.114.114.114; };  # 转发器（外网解析）
       allow-query { any; };  # 允许所有主机查询（内网可限制网段）
       recursion yes;
   };
   ```
3. **配置内网域名解析**

   * 编辑 `/etc/bind/named.conf.local`，添加区域配置：
     
     ```conf
     zone "test.local" {
         type master;
         file "/etc/bind/db.test.local";  # 区域数据文件
     };
     ```
   * 创建区域数据文件 `/etc/bind/db.test.local`：
     conf
   
     ```conf
     $TTL    604800
     @       IN      SOA     ns.test.local. admin.test.local. (
                                 2024050101  ; Serial
                                 604800      ; Refresh
                                 86400       ; Retry
                                 2419200     ; Expire
                                 604800 )    ; Negative Cache TTL
     @       IN      NS      ns.test.local.
     ns      IN      A       192.168.1.100  ; DNS 服务器 IP
     web     IN      A       192.168.1.101  ; 内网网站 IP
     ```
4. **启动服务并验证**
   
   ```bash
   systemctl restart bind9
   # 测试解析
   nslookup web.test.local 192.168.1.100
   ```

## 五、4. SSH 服务（openssh-server）

SSH 是 Linux 远程管理的核心服务，默认已安装，需优化配置提升安全性。

### 安全配置步骤

1. **确认服务状态**
   
   ```bash
   systemctl status sshd  # CentOS/RHEL
   systemctl status ssh   # Ubuntu
   ```
2. **编辑配置文件**
   编辑 `/etc/ssh/sshd_config`：conf

   ```conf
   Port 2222  # 修改默认 22 端口（降低暴力破解风险）
   PermitRootLogin no  # 禁止 root 直接登录
   PasswordAuthentication yes  # 保留密码登录（或禁用，仅用密钥）
   AllowUsers admin  # 仅允许 admin 用户登录
   ```
3. **重启服务并验证**
   bash

   运行

   ```bash
   systemctl restart sshd  # CentOS/RHEL
   systemctl restart ssh   # Ubuntu
   # 远程连接测试
   ssh admin@服务器IP -p 2222
   ```

## 六、5. DHCP 服务（dhcpd）

DHCP 用于内网自动分配 IP 地址，避免手动配置的繁琐。

### 部署步骤（CentOS 为例）

1. **安装 dhcpd**
   
   ```bash
   yum install -y dhcp
   ```
2. **配置 DHCP**
   编辑 `/etc/dhcp/dhcpd.conf`：conf

   ```conf
   subnet 192.168.1.0 netmask 255.255.255.0 {
       range 192.168.1.100 192.168.1.200;  # IP 分配范围
       option routers 192.168.1.1;  # 网关
       option domain-name-servers 223.5.5.5, 114.114.114.114;  # DNS
       option subnet-mask 255.255.255.0;
       default-lease-time 600;  # 默认租期
       max-lease-time 7200;     # 最大租期
   }
   ```
3. **启动服务**
   
   ```bash
   systemctl start dhcpd
   systemctl enable dhcpd
   ```

## 七、6. 数据库服务（MySQL 8.0）

MySQL 是主流关系型数据库，常用于业务数据存储，以下为最简部署流程。

### 部署步骤

1. **安装 MySQL**

   * CentOS/RHEL：
     
     ```bash
     # 安装官方源
     wget https://dev.mysql.com/get/mysql80-community-release-el8-3.noarch.rpm
     rpm -ivh mysql80-community-release-el8-3.noarch.rpm
     yum install -y mysql-community-server
     ```
   * Ubuntu：
     
     ```bash
     apt install -y mysql-server
     ```
2. **启动并初始化**
   
   ```bash
   systemctl start mysqld
   systemctl enable mysqld
   # 获取初始密码（CentOS）
   grep "temporary password" /var/log/mysqld.log
   ```
3. **安全配置**
   
   ```bash
   mysql_secure_installation  # 重置密码、删除匿名用户、禁止远程 root 登录
   ```
4. **允许远程访问**
   
   ```sql
   # 登录 MySQL
   mysql -uroot -p
   # 创建远程用户
   CREATE USER 'dbuser'@'%' IDENTIFIED BY 'Password@123';
   GRANT ALL PRIVILEGES ON *.* TO 'dbuser'@'%';
   FLUSH PRIVILEGES;
   ```

## 八、通用故障排查方法

1. **服务启动失败** ：查看系统日志 `journalctl -u 服务名`（例如 `journalctl -u nginx`）。
2. **端口未监听** ：使用 `ss -tulnp | grep 端口号` 检查端口占用。
3. **访问超时** ：确认防火墙 / SELinux 已放行端口，且服务配置无网段限制。
4. ###### **权限问题** ：检查服务相关目录 / 文件的权限（例如 Nginx 网站目录需 `nginx` 用户可读）。
