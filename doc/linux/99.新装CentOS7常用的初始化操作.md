# 新装CentOS7常用的初始化操作

## 1、基本信息
查看版本
```bash
cat /etc/centos-release
```
查看内核版本
```bash
uname -r
```
改计算机名

```bash
hostnamectl set-hostname name
```
 配置网络

```bash
vi /etc/sysconfig/network-scripts/ifcfg-ens33
```

以下是必填部分
```bash
TYPE=Ethernet			#设置网卡类型，“Ethernet”表示以太网
DEVICE=ens33			#设置网卡的名称
ONBOOT=yes				#设置网卡是否在 Linux 操作系统启动时激活
BOOTPROTO=static		#设置网卡的配置方式，“static”表示使用静态IP地址，“dhcp”时表示动态获取地址
IPADDR=192.168.80.3		#设置网卡的 IP 地址
NETMASK=255.255.255.0	#设置网卡的子网掩码
GATEWAY=192.168.80.2	#设置网卡的默认网关地址
DNS1=192.168.80.2		#设置DNS服务器的 IP 地址
```
实际有这么多行，其实大部分不需要更改
网络配置文件内容编辑如下（有注释的是必须改的）：

```bash
TYPE="Ethernet"
BOOTPROTO="static"    #静态
DEFROUTE="yes"
PEERDNS="yes"
PEERROUTES="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="yes"
IPV6_AUTOCONF="yes"
IPV6_DEFROUTE="yes"
IPV6_PEERDNS="yes"
IPV6_PEERROUTES="yes"
IPV6_FAILURE_FATAL="no"
NAME="eno16777736"
UUID="0e6ca219-0d2e-4000-8f17-bf7424e46595"
DEVICE="eno16777736"
ONBOOT="yes"        #开机开启网卡
IPADDR=192.168.255.101
GATEWAY=192.168.255.2
NETMASK=255.255.255.0
DNS=114.114.114.114
```

## 2、更改系统源
首先备份源 /ect/yum.repos.d/CentOS-Base.repo，在安装之前我们先必须安装wget
```bash
mv  /etc/yum.repos.d/CentOS-Base.repo  /etc/yum.repos.d/CentOS-Base.repo.bak
curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
```
其他镜像源

```python
阿里云 CentOS 7 源（推荐）：
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo

网易163 CentOS 7 源：
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.163.com/.help/CentOS7-Base-163.repo
 
搜狐 CentOS 7 源：
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.sohu.com/help/CentOS7-Base-sohu.repo
 
华为云 CentOS 7 源：
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.myhuaweicloud.com/repo/CentOS-7.repo
 
华东理工大学 CentOS 7 源：
wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.ustc.edu.cn/centos/7/os/x86_64
 
清华大学 CentOS 7 源：
wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.tuna.tsinghua.edu.cn/centos/7/os/x86_64/
 
北京理工大学 CentOS 7 源：
wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.bfsu.edu.cn/centos/7/os/x86_64/
 
上海交通大学 CentOS 7 源：
wget -O /etc/yum.repos.d/CentOS-Base.repo https://ftp.sjtu.edu.cn/centos/7/os/x86_64/
 
中国科学技术大学 CentOS 7 源：
wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.ustc.edu.cn/centos/7/os/x86_64/
 
兰州大学 CentOS 7 源：
wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirror.lzu.edu.cn/centos/7/os/x86_64/

```

### docker源
```bash
wget -O /etc/yum.repos.d/docker-ce.repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
```
### python源

```bash
yum install python36 -y
mkdir ~/.pip
cd ~/.pip
vim pip.conf
```
添加以下内容
```bash
[global]
trusted-host=mirrors.aliyun.com
index-url=http://mirrors.aliyun.com/pypi/simple/
```


### 清楚缓存、生成新缓存

```bash
yum clean all && yum makecache
```

## 3、更新系统

### 方法一：只升级包

 - 升级所有包 
 - 不改变软件设置和系统设置 
 - 系统版本升级
 - 内核不改变

```bash
yum -y upgrade
```
### 方法二：全升级
- 升级所有包
- 改变软件设置和系统设置
- 系统版本内核都升级
```bash
yum -y update
```
生产服务器千万别这么干，总之不建议使用update。
如果这么服务器上部署了好多服务，这么干你小则罚款记过，大则离职跑路。 

> 详细请看这里：https://blog.csdn.net/weixin_34415923/article/details/92598179

## 4、常用的依赖
以下是一些必装依赖、软件、服务、组件，可以根据你的实际情况选择安装。
### 必装依赖和组件

|组件  | 功能 |
|--|--|
| gcc  glibc  gcc-c++  make cmake | 编译器，编译安装的时候会用到 |
| net-tools | #Linux内核中配置网络功能的工具 |
| screen  |#用于命令行终端切换  |
|vim    | #编辑器 |
| lrzsz   | #拖动上传，sz下载 |
|tree   | #树形目录 |
| dos2unix | #Windows格式文件转换为Unix、Linux格式的实用命令 |
| lsof    |#列出当前系统打开文件的工具  |
|tcpdump  | #抓包工具 |
| bash-completion | #自动补全功能增强 |
|ntp  |#同步网络事件  |
|psmisc    | #帮助管理/proc目录的程序 |
| openssl    openssl-devel |#web安全通信的基石，没有openssl，可以说我们的信息都是在裸奔 |

分开复制
```bash
yum -y install gcc
yum -y install glibc 
yum -y install gcc-c++ 
yum -y install make 
yum -y install cmake
yum -y install net-tools
yum -y install screen
yum -y install vim
yum -y install lrzsz
yum -y install tree
yum -y install dos2unix
yum -y install lsof
yum -y install tcpdump
yum -y install bash-completion
yum -y install wget
yum -y install ntp
yum -y install setuptool
yum -y install psmisc
yum -y install openssl
yum -y install openssl-devel
yum -y install bind-utils
yum -y install traceroute
yum -y install epel-release
yum -y install bash-completion bash-completion-extras
```

一键安装上面所有

```bash
yum -y install gcc glibc gcc-c++ make cmake net-tools screen vim lrzsz tree dos2unix lsof tcpdump bash-completion wget ntp setuptool psmisc openssl openssl-devel bind-utils traceroute epel-release bash-completion bash-completion-extras bash-completion
```

###  图形化配置网络/服务/防火墙
不建议在服务器上安装，初学者虚拟机里玩玩就行了。

|组件  | 功能 |
|--|--|
| setuptool | #安装setup命令工具 |
| ntsysv  | #安装setup工具配套的系统服务组件 |
|system-config-securitylevel-tui   |  #安装setup工具配套的防火墙配置组件 |
| NetworkManager-tui | #安装setup工具配套的网络配置组件 |
|authconfig-gtk   |   #安装setup工具配套的验证配置组件|
|system-config-keyboard   |   #安装setup工具配套的键盘配置组件|
|bind-utils      |     #解决没有nslookup命令|


一键安装

```bash
yum -y install setuptool ntsysvsystem-config-securitylevel-tui networkManager-tui authconfig-gtk system-config-keyboard bind-utils
```

## 5、关闭防火墙和SELinux
```bash
systemctl disable firewalld
systemctl stop firewalld
sed -i 's/^ *SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config
```

## 6、sudo授权管理

添加普通用户并进行sudo授权管理

- 免密码切换到root用户：https://blog.csdn.net/annita2019/article/details/124820092
- 禁止root用户远程登录、特定用户可以切换root：https://blog.csdn.net/annita2019/article/details/106233955

## 7、默认打开vim增加行号

```bash
echo "set number" >> ~/.vimrc
```

## 8、更改ssh默认端口
https://blog.csdn.net/annita2019/article/details/104373844
## 9、禁止root远程登录

禁止root远程登录 切记给系统添加普通用户，给su到root的权限

https://blog.csdn.net/annita2019/article/details/106233955
## 10、root用户优化

root用户密码输入错误三次，锁定账户一段时间

https://blog.csdn.net/weixin_34377065/article/details/89832979
## 11、设置时区并同步时间

```
sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && ntpdate time.windows.com
```

## 12、历史命令显示操作时间

```bash
export HISTTIMEFORMAT="[%Y.%m.%d %H:%M:%S-$USER_IP-$USER]" >> /etc/profile
sed -i 's/1000/50000/' /etc/profile
source /etc/profile
```

https://blog.csdn.net/weixin_42386617/article/details/100726889
## 13、SSH超时时间
登录后如果限定时间内没有操作侧自动断开连接，以5分钟为例
```bash
 echo "export TMOUT=300" >> /etc/profile
 source /etc/profile
```

https://blog.csdn.net/weixin_34357887/article/details/92131646
## 14、禁止定时任务向发送邮件
```bash
sed -i 's/^MAILTO=root/MAILTO=""/' /etc/crontab
```
## 15、解决ssh链接缓慢的问题

```bash
sed -i 's/^ *GSSAPIAuthentication yes/GSSAPIAuthentication no/g' /etc/ssh/sshd_config
cat /etc/ssh/sshd_config | grep "^GSSAPIAuthentication"

sed -i 's/^ *#UseDNS yes/UseDNS no/g' /etc/ssh/sshd_config 
cat /etc/ssh/sshd_config | grep "UseDNS"
```


## 其他命令

```bash
pam_tally2 --user root    #查看用户登陆失败的次数
```

不断更新





