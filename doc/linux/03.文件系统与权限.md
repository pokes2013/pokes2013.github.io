》》03.文件系统与权限

# Linux 文件系统与权限深度解析

## 一、Linux 文件系统基础

### 1.1 文件系统核心概念

- **文件系统（Filesystem）**：定义了文件在存储设备上的存储格式、组织方式及访问规则（如 ext4、XFS、Btrfs 等）。
- **目录树（Directory Tree）**：Linux 采用单一树形结构，所有文件和目录都挂载在根目录 `/` 下。
- **挂载（Mount）**：将存储设备关联到目录树的某个节点，使系统能通过该目录访问设备数据。
- **inode**：文件的元数据索引，每个文件对应唯一 inode 编号。

### 1.2 常见文件系统类型

| 文件系统 | 特点                                        | 适用场景                             |
| :------- | :------------------------------------------ | :----------------------------------- |
| ext4     | 稳定、兼容好、支持日志功能，最大单文件 16TB | 服务器系统盘、数据盘（最常用）       |
| XFS      | 高性能、支持大文件/大分区，读写速度快       | 数据库、大数据存储（CentOS 7+ 默认） |
| Btrfs    | 支持快照、RAID、动态扩容，容错性强          | 云服务器、需要频繁备份的场景         |
| tmpfs    | 基于内存的临时文件系统，重启后数据丢失      | 存储临时文件（/tmp 目录默认使用）    |

### 1.3 重要目录功能（FHS 标准）

- `/`：根目录，所有文件的起点
- `/bin`：存放系统核心命令（如 ls、cp、mv）
- `/etc`：配置文件目录
- `/home`：普通用户主目录
- `/var`：可变数据目录（如日志、邮件）

## 二、Linux 权限模型详解

### 2.1 权限的三个维度

#### （1）访问主体（Who）

- **所有者（User）**：文件的创建者
- **所属组（Group）**：文件归属的用户组
- **其他用户（Other）**：既非所有者也不属于所属组的用户

#### （2）权限类型（What）

| 权限字符     | 数字值 | 文件权限含义   | 目录权限含义          |
| :----------- | :----- | :------------- | :-------------------- |
| r（read）    | 4      | 可读取文件内容 | 可列出目录内文件      |
| w（write）   | 2      | 可修改文件内容 | 可创建/删除目录内文件 |
| x（execute） | 1      | 可执行文件     | 可进入目录            |

### 2.2 权限组合示例

| 权限字符串 | 数字权限 | 含义                                               |
| :--------- | :------- | :------------------------------------------------- |
| rw-r--r--  | 644      | 所有者：读+写；所属组：读；其他：读                |
| rwxr-xr-x  | 755      | 所有者：读+写+执行；所属组：读+执行；其他：读+执行 |
| rw-------  | 600      | 仅所有者可读写                                     |

## 三、权限实战操作命令

### 3.1 查看权限：`ls -l`

```bash
ls -l /etc/passwd
# 输出示例：-rw-r--r--. 1 root root 1213 10月 1 10:00 /etc/passwd
```

### 3.2 修改所有者：`chown`

```bash
chown user1:group1 test.txt  # 修改文件所有者和所属组
chown -R user1:group1 /data  # 递归修改目录权限
```

### 3.3 修改权限：`chmod`

```bash
# 字符模式
chmod u+x test.sh            # 给所有者添加执行权限
chmod g-w test.txt           # 给所属组移除写权限

# 数字模式
chmod 644 test.txt           # 设置权限为 rw-r--r--
chmod 755 /data              # 设置目录权限为 rwxr-xr-x
```

## 四、文件系统操作实战

### 4.1 磁盘分区与格式化

```bash
# 查看磁盘分区
fdisk -l /dev/sdb

# 格式化分区
mkfs.ext4 /dev/sdb1

# 挂载分区
mkdir /mnt/data
mount /dev/sdb1 /mnt/data
```

### 4.2 查看磁盘使用情况

```bash
df -h  # 查看分区挂载情况
du -sh /var/log  # 查看目录占用空间
```

**注意：** 本文档仅为基础介绍，实际操作时请谨慎执行权限修改和磁盘操作命令。

## 五、权限排障常见场景

- **无法进入目录**：目录缺少执行权限（x），解决：`chmod +x 目录名`
- **无法修改文件**：文件或所在目录缺少写权限（w）
- **脚本无法执行**：脚本缺少执行权限（x），解决：`chmod +x 脚本名`

## 六、进阶：权限与安全最佳实践

1. **最小权限原则**：不给用户/文件分配多余权限
2. **避免使用 777 权限**：存在严重安全风险
3. **重要文件权限加固**：如 /etc/shadow 设置为 000
4. **定期检查权限**：使用 find 命令查找异常权限文件
