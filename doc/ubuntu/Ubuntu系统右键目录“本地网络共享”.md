

# Ubuntu系统：右键目录“本地网络共享”



今天遇到一个问题：同样是Ubuntu系统，在图形化界面中为什么别人右键目录有“本地网络共享”，我没有...



## 一、安装软件包

您好！这是一个非常常见的问题，原因很简单：**您没有安装让图形化界面（GUI）支持Samba共享所必需的软件包**。

Ubuntu的默认安装为了保持系统精简，并不会预装所有功能组件。那个“本地网络共享”的右键菜单选项就是一个需要额外安装的功能。

### 主要原因与解决方案

核心原因是缺少 `nautilus-share` 这个软件包。Nautilus 是 Ubuntu 默认使用的文件管理器（就是您用来浏览文件的那个窗口），而这个包为 Nautilus 增添了共享功能。

**解决方法：只需一行命令，安装所需的软件包。**

1. **打开终端** (Ctrl+Alt+T)。

2. 复制并粘贴以下命令，然后按回车：

   bash

   ```
   sudo apt update && sudo apt install nautilus-share samba-common-bin
   ```

   

   - `sudo`: 获取管理员权限。
   - `apt update`: 更新软件包列表，确保获取到最新的版本信息。
   - `apt install`: 安装软件包。
   - `nautilus-share`: **这是最关键的那个包**，它提供了右键菜单的选项。
   - `samba-common-bin`: 包含Samba共享所需的一些基本工具和库。虽然有时候只安装 `nautilus-share` 也会自动安装它，但为了保险起见，我们显式地一起安装。

3. 系统会提示您输入当前登录用户的密码（输入时密码不可见），输入后按回车继续。

4. 安装过程很快。安装完成后，**最重要的一步：需要重启文件管理器或注销系统**。

   - **最简单的方法：注销当前用户然后再重新登录。**
   - 或者，可以在终端中运行 `nautilus -q` 来彻底关闭Nautilus，它通常会自动重新启动。

完成之后，当您再次右键点击一个文件夹时，应该就能看到“本地网络共享”选项了。

------

### 如果安装后仍然没有？请检查以下步骤：

1. **确保您右键点击的是“文件夹”而不是文件。** 这个选项只对文件夹有效。
2. **检查安装是否成功**：在终端里再次运行 `apt list --installed | grep nautilus-share`，看看是否有输出结果，确认它已安装。
3. **重启电脑**：如果注销重登没生效，尝试完全重启系统，这能确保所有组件重新加载。

------

### 进阶信息：它的工作原理是什么？

这个“本地网络共享”功能背后使用的是 **Samba** 协议。Samba是一个开源软件套件，它让Linux系统能够与Windows系统通过网络共享文件和打印机（反之亦然）。

- 当您勾选“共享此文件夹”时，Nautilus（通过 `nautilus-share`）会在后台帮您自动完成以下工作：
  1. 修改Samba的配置文件 (`/etc/samba/smb.conf`)。
  2. 设置文件夹的Linux文件权限，使其可被其他用户访问。
  3. 如果需要，还会帮您启动或重启Samba服务。

### 总结

| 可能的原因                   | 解决方案                                   |
| :--------------------------- | :----------------------------------------- |
| **缺少 `nautilus-share` 包** | **运行 `sudo apt install nautilus-share`** |
| 文件管理器未刷新             | **注销再重新登录**                         |

所以，别担心，您的系统没有任何问题，只是缺少了一个小小的功能扩展包。安装之后，您的右键菜单就会变得和别人的一样了。





## 二、权限问题报错



安装完如果报错：

```
安装完有了，但是出现“net usershare”返回错误 255：net usershare: cannot open usershare directory /var/lib/samba/usershares. Error 权限不够
You do not have permission to create a usershare. Ask your administrator to grant you permissions to create a share.
```

非常好！您已经成功安装了软件包，但现在遇到了一个**权限问题**。这是一个非常典型的后续步骤。

错误信息的核心是：**您当前的用户没有被加入到Samba的用户分享权限组中**，因此没有权利创建和管理共享文件夹。

别担心，解决方法很简单，只需要两步：

### 解决方案

#### 步骤一：将您的用户添加到 `sambashare` 用户组

Samba使用一个名为 `sambashare` 的系统用户组来管理谁有权限创建共享。您需要将您的用户名加入这个组。

1. **打开终端** (Ctrl+Alt+T)。

2. 运行以下命令（请将 `你的用户名` 替换为您实际登录的用户名，通常终端提示符 `@` 前面的就是，如果不确定，可以运行 `whoami` 命令查看）：

   bash

   ```
   sudo usermod -aG sambashare 你的用户名
   ```

   

   - 例如，如果你的用户名是 `zhangsan`，那么命令就是：`sudo usermod -aG sambashare zhangsan`
   - `sudo`: 获取管理员权限。
   - `usermod`: 修改用户的命令。
   - `-aG`: 选项表示“追加（Append）”用户到指定的“组（Group）”，这样不会覆盖用户已有的其他组身份。

#### 步骤二：注销并重新登录（至关重要！）

**这是最关键的一步，否则更改不会生效。** 用户组信息的更新只在用户首次登录时读取。仅仅重启终端是没用的。

- **最简单有效的方法：完全注销当前用户会话，然后重新登录。**
- 或者，重启电脑也可以。

完成这两步后，再尝试右键点击文件夹 -> 选择“本地网络共享”，就应该可以正常启用共享而不会报错了。