# 二三层接口转换

‍



`undo portswitch` 是**华为交换机**的命令，作用是将交换机的**二层以太网端口切换为三层以太网端口**。

```bash
# 进入系统视图
<Huawei> system-view
[Huawei]

# 进入端口视图（以GigabitEthernet 0/0/1为例）
[Huawei] interface GigabitEthernet 0/0/1

# 切换为三层端口
[Huawei-GigabitEthernet0/0/1] undo portswitch

# 配置三层端口的IP地址（示例：192.168.1.1/24）
[Huawei-GigabitEthernet0/0/1] ip address 192.168.1.1 255.255.255.0

# 启用端口（默认可能已启用）
[Huawei-GigabitEthernet0/0/1] undo shutdown
```



如何查看undo portswitch命令是否生效？

```bash
display interface GigabitEthernet 0/0/1
```

关键判断

- 回显出现 **Route Port** → 三层模式，`undo portswitch` 生效。
- 回显出现 **Switch Port** → 二层模式，命令未生效或被恢复。
- 同时可核对是否有 **Internet Address**（三层可配 IP，二层不可）。



# 华为交换机二层/三层端口配置对比清单

|     **对比维度**     |                 **二层端口（Switch Port）**                  |                  **三层端口（Route Port）**                  |
| :------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|     **核心模式**     |       工作在数据链路层（Layer 2），仅负责二层数据交换        |          工作在网络层（Layer 3），支持路由转发功能           |
|     **配置命令**     |                端口视图默认模式：`portswitch`                |             端口视图手动切换：`undo portswitch`              |
|     **IP 配置**      | **不支持直接配置 IP 地址**，需通过 SVI 接口（VLANIF）实现三层互通 | **支持直接配置 IP 地址**：`ip address 192.168.1.1 255.255.255.0` |
|  **VLAN 相关配置**   | 支持所有二层 VLAN 命令：- 接入端口：`port access vlan 10` -  trunk 端口：`port trunk allow-pass vlan all` -  hybrid 端口：`port hybrid pvid vlan 10` | **不支持二层 VLAN 命令**（如 `port access/trunk/hybrid`）；三层子接口可通过 `dot1q termination vid 10` 实现 VLAN 透传 |
|     **路由功能**     | 无路由转发能力，需依赖三层设备（如路由器、三层交换机的 VLANIF） | 支持静态路由、动态路由协议（OSPF、RIP 等）；配置 IP 后自动生成直连路由 |
| **查看端口模式命令** | `display interface GE 0/0/1` → 显示 `Switch Port` `display interface brief` → Port Mode 为 `SWITCH` | `display interface GE 0/0/1` → 显示 `Route Port` `display interface brief` → Port Mode 为 `ROUTE` |
|   **典型使用场景**   | 1. 连接终端设备（电脑、打印机、摄像头） 2. 交换机之间的二层互联 3. 接入层交换机的用户端口 | 1. 连接路由器、防火墙等三层设备 2. 不同网段的跨 VLAN 直连转发 3. 核心层交换机的上行端口 |
|   **端口状态标识**   |         接口描述无 `Route Port` 字段，无 IP 地址信息         |       接口描述含 `Route Port` 字段，显示配置的 IP 地址       |
|   **配置保存验证**   | `display this` 查看接口配置 → 含 `portswitch` 或默认无该命令 |      `display this` 查看接口配置 → 含 `undo portswitch`      |
|   **设备支持限制**   |                    所有交换机端口默认支持                    |    部分低端交换机（如 S1700 系列）部分端口不支持三层模式     |



### 补充说明

1. 二层端口切换为三层端口前，需**先删除该端口的所有二层配置**（如 VLAN 绑定、trunk/hybrid 模式配置），否则 `undo portswitch` 命令会执行失败。
2. 三层端口若需恢复为二层模式，直接在端口视图执行 `portswitch` 命令即可。
3. 三层子接口（如 `GE 0/0/1.10`）是基于三层物理端口的虚拟接口，用于单端口透传多 VLAN 流量，本质仍属于三层端口范畴。

是否需要我帮你整理**二层转三层端口的排错步骤清单**？
