

@[TOC](华为防火墙新手必看：核心配置项与常见避坑指南)

华为防火墙是华为公司推出的网络安全产品系列，旨在为企业、运营商和数据中心提供全面的<font color='red'>网络边界防护、入侵检测、访问控制等安全功能</font>。华为防火墙基于自研芯片（如Ascend系列）和HarmonyOS操作系统（部分型号），结合AI技术，提供高性能、智能化的安全防护解决方案。

## 第一节：了解部分

> 主要产品系列(截止2025年6月)：
> 
> - **USG系列（Unified Security Gateway）**，定位：<font color='red'>面向中小型企业或分支机构，提供基础防火墙、VPN、入侵防御（IPS）、防病毒（AV）等功能。</font>代表型号：USG6000E系列（如USG6630E）、USG6000F系列（AI加持）。
> 
> - **NGFW（下一代防火墙）**，定位：中高端企业级防火墙，支持<font color='red'>深度报文检测（DPI）、应用识别、沙箱分析、威胁情报联动等</font>。代表型号：USG9500系列（如USG9520、USG9560），支持<font color='red'>TB级吞吐</font>。
> 
> - **HiSecEngine系列**，定位：AI驱动的安全引擎，<font color='orange'>集成AI检测模型</font>，适用于云化、SDN网络环境。代表型号：HiSecEngine
> USG12000系列（如USG12000-8T）。
> 
> - **虚拟化防火墙（vFW）**，定位：为云环境（如华为云、私有云）提供虚拟化安全防护，支持弹性扩展。代表产品：vUSG（虚拟化USG）。

核心功能（面试必备）

> - <font color='red'>访问控制：基于五元组、应用类型、用户身份的策略管控。</font>
> - <font color='red'>威胁防护：IPS/IDS、防病毒、Web过滤、APT防御。</font>
> - <font color='red'>VPN支持：IPSec VPN、SSL VPN、L2TP VPN。</font>
> - <font color='red'>智能分析：AI驱动的异常流量检测（如DDoS）、加密流量分析（ETA）。</font>
> - <font color='red'>高可用性：支持双机热备（HA）、负载均衡。</font>
> - <font color='red'>云化管理：可通过华为SecoManager或HiSec Insight平台集中管理。</font>

技术亮点

> - AI加持：部分型号集成AI芯片，提升威胁检测效率（如HiSecEngine系列）。
> - HarmonyOS加持：部分新机型运行华为自研操作系统，增强安全性。
> - 云边协同：支持与华为云安全服务（如Anti-DDoS、WAF）联动。
> - 国产化适配：符合中国等保2.0、GDPR等合规要求。

## 第二节：实验部分

![在这里插入图片描述](./32、华为防火墙.assets/2586586baeac476bbfd8ccaaa1987a94.png)


## 一、接口地址的配置
如上图所示
## 二、防火墙划分区域

> 防火墙的默认区域(zone)：一般可分为<font color='orange'>local、trust、untrust、dmz</font>，每个区域都有各自的优先级。
>
> 优先级代表着可信程度，<font color='red'>优先级越高表示越信任，即数字越大越信任。</font>

下面是默认区域的默认优先级：

```bash
[SRG]dis zone 
22:15:49  2020/11/18
local  #本地区域
 priority is 100  #默认优先级100
 
#
trust #内网用户
 priority is 85   #默认优先级85
 interface of the zone is (1):
    GigabitEthernet0/0/0
    
#
untrust #外网用户
 priority is 5  #默认优先级5
 interface of the zone is (0):
 
#
dmz  #dmz区域
 priority is 50   #默认优先级50
 interface of the zone is (0):
#

```

拿到防火墙第一时间更改密码，之后就需要给接口划分区域：

```bash
[fw1]firewall zone trust 	
[fw1-zone-trust]add interface g0/0/0
[fw1-zone-trust]q
	
[fw1]firewall zone untrust 
[fw1-zone-untrust]add interface g0/0/2
[fw1-zone-untrust]q
	
[fw1]firewall zone dmz
[fw1-zone-dmz]add interface g0/0/1
[fw1-zone-dmz]q
```

## 三、各个设备的静态路由

```bash
[fw1]ip route-static 192.168.10.0 24 12.1.1.1
[fw1]ip route-static 192.168.30.0 24 23.1.1.2

[ar1]ip route-static 0.0.0.0 0 12.1.1.2
[ar2]ip route-static 10.10.30.0 24 23.1.1.1
```

此时在防火墙FW1上可以ping通PC1、PC2、PC3,但PC1仍然无法和PC2、PC3通信。因为我们还没有配置防火墙策略。

<font color='red'>那为什么防火墙上可以ping通PC1、PC2、PC3？那是因为防火墙的默认规则。</font>

> **<font color='orange'>防火墙的默认策略</font>**
>
> ```bash
> <SRG>dis cu
> ...
>  firewall packet-filter default permit interzone local trust direction inbound   
>  #permit允许，local本地区域，trust内网区域，inbound：优先级由低——>高
>  上面的意思就是：local本地区域，trust内网区域，这两个区域默认允许低——>高
>  
>  firewall packet-filter default permit interzone local trust direction outbound
>  上面的意思就是：local本地区域，trust内网区域，这两个区域默认允许高——>低
>  
>  firewall packet-filter default permit interzone local untrust direction outboun
>  上面的意思就是：local本地区域，untrust外网区域，这两个区域默认允许高——>低
> ...
> 
> ```
>
> 三条默认策略组合起来意思就是：
>
> - 默认防火墙和内网区域允许进和出，即相互通信；
> - 防火墙和外网区域之间，只能出不能进。即防火墙可以ping通外网，外网无法ping通防火墙；
> - 同样防火墙访问DMZ，也是只能出不能进。即防火墙可以ping通DMZ的server，但server无法ping通防火墙。

## 四、内网访问外网

策略1：内网访问外网

```bash
[fw1]firewall packet-filter default permit interzone trust untrust direction outbound  #注意方向
19:19:06  2025/04/08
Warning:Setting the default packet filtering to permit poses security risks. You
 are advised to configure the security policy based on the actual data flows. 
 Are you sure you want to continue?[Y/N]y    ##需要确认
```

> <font color='red'>防火墙策略的方向</font>
>
> - outbound：高优先级访问低优先级
> - inbound：低优先级访问高优先级

内网用户需要访问外网除了配置策略，还需要在防火墙上面配置NAT.防火墙的NAT和路由器有些许的不同，方法如下：

防火墙的NAT配置

```bash
[fw1]nat-policy interzone trust untrust outbound 	
[fw1-nat-policy-interzone-trust-untrust-outbound]policy 1
[fw1-nat-policy-interzone-trust-untrust-outbound-1]action sou	
[fw1-nat-policy-interzone-trust-untrust-outbound-1]action source-nat	
[fw1-nat-policy-interzone-trust-untrust-outbound-1]easy-ip g0/0/2
```

## 五、DMZ区域访问外网

策略2：允许DMZ区域访问外网

```bash
[fw1]firewall packet-filter default permit interzone dmz untrust direction outbound 
19:44:54  2025/04/08
Warning:Setting the default packet filtering to permit poses security risks. You
 are advised to configure the security policy based on the actual data flows. Ar
e you sure you want to continue?[Y/N]y
```

DMZ区域一般都是对外提供服务，拥有固定IP地址，所以无需配置NAT。如果没有固定IP则和上面的NAT配置相同。

## 六、内网用户访问DMZ区域

策略2：允许内网用户访问DMZ区域

```bash
[fw1]firewall packet-filter default permit interzone trust dmz direction outbound 
19:33:03  2025/04/08
Warning:Setting the default packet filtering to permit poses security risks. You
 are advised to configure the security policy based on the actual data flows. Ar
e you sure you want to continue?[Y/N]y
```

## 七、外网访问DMZ区域

策略3：允许外网访问DMZ区域

```bash
[fw1]firewall packet-filter default permit interzone untrust dmz direction inbound 
19:38:20  2025/04/08
Warning:Setting the default packet filtering to permit poses security risks. You
 are advised to configure the security policy based on the actual data flows. Ar
e you sure you want to continue?[Y/N]y
```

