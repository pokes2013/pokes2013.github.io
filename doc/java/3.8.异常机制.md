# 3.8.异常机制

‍

---

## 什么是异常

实际工作中，遇到的情况不可能是非常完美的。比如：你写的某个模块，用户输入不一定符合你的要求、你的程序要打开某个文件，这个文件可能不存在或者文件格式不对，你要读取数据库的数据，数据可能是空的等。我们的程序再跑着，内存或硬盘可能满了。等等。

软件程序在运行过程中，非常可能遇到刚刚提到的这些异常问题，我们叫异常，英文是：==Exception==，意思是例外。这些，例外情况，或者叫异常，怎么让我们写的程序做出合理的处理。而不至于程序崩溃。

异常指程序运行中出现的不期而至的各种状况，如：文件找不到、网络连接失败、非法参数等。  
异常发生在程序运行期间，它影响了正常的程序执行流程。

## 异常的分类

要理解Java异常处理是如何工作的，你需要掌握以下三种类型的异常：

* 检查性异常：最具代表的检查性异常是用户错误或问题引起的异常，这是程序员无法预见的。例如要打开一个不存在文件时，一个异常就发生了，这些异常在编译时不能被简单地忽略。
* 运行时异常：运行时异常是可能被程序员避免的异常。与检查性异常相反，运行时异常可以在编译时被忽略。
* 错误：错误不是异常，而是脱离程序员控制的问题。错误在代码中通常被忽略。例如，当栈溢出时，一个错误就发生了，它们在编译也检查不到的。

## 异常体系结构

* java把异常当做对象来处理，并定义一个基类java.lang.Thrwable作为所有异常的超类。
* 在Java API中已经定义了许多异常类，这些异常类分为两大类，错误Error和异常Exception

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/8331a6263c7e4fdfb5126744848af966.png)

### Error

* Error类对象由Java虚拟机生成并抛出，大多数错误与代码编写者所执行的操作无关。
* Java虚拟机运行错误（VirtualMachineError），当JVM不再有继续执行操作所需的内存资源时，将出现==OutOfMemoryError==。这些异常发生时，Java虚拟机（JVM）一般会选择线程终止;
* 还有发生在虚拟机试图执行应用时，如类定义错误（NoClassDefFoundError）、链接错误（LinkageError）。这些错误是不可查的，因为它们在应用程序的控制和处理能力之外，而且绝大多数是程序运行时不充许出现的状况。

### Exception

* 在Exception分支中有一个重要的子类RuntimeException（运行时异常）

  * ArraylndexOutOfBoundsException（数组下标越界）
  * NullPointerException（空指针异常） ArithmeticException（算术异常）
  * MissingResourceException（丢失资源）
  * ClassNotFoundException（找不到类）等异常，这些异常是不检查异常，程序中可以选择捕获处理，也可以不处理。
* 这些异常一般是由程序逻辑错误引起的，程序应该从逻辑角度尽可能避免这类异常的发生；
* Error和Exception的区别：Error通常是灾难性的致命的错误，是程序无法控制和处理的，当出现这些异常时，Java虚拟机（JVM）一般会选择终止线程；Exception通常情况下是可以被程序处理的，并且在程序中应该尽可能的去处理这些异常。

## 异常处理机制

* 抛出异常
* 捕获异常

常用的五个关键字：

* try，包裹异常监控区域
* catch，捕获异常，catch里面的参数就是想要捕获的异常类型
* finally，处理善后工作，无论程序是否出异常都会执行完毕
* throw，主动抛出异常
* throws

try，catch，finally的演示：

```java
package com.pokes015;

//异常
public class Demo01 {
    public static void main(String[] args) {
        int a = 1;
        int b = 0;
        //System.out.println(a / b); 报错
        /*Exception in thread "main" java.lang.ArithmeticException: / by zero
            at com.pokes015.Demo01.main(Demo01.java:8) */
    

        //try，包裹异常监控区域
        //catch，捕获异常，catch里面的参数就是想要捕获的异常类型
        //finally，处理善后工作，无论程序是否出异常都会执行完毕


        try {
            System.out.println(a / b);
        } catch (ArithmeticException e) {
            System.out.println("自定义提示：程序出现异常，变量b不能为0");
        } finally {
            System.out.println("处理善后工作：执行完毕");
        }
    }
}

```

上面的代码中可以不要finally，一般finally用于善后工作，假设IO，资源关闭。  
当然你可以捕获多个异常，多次使用catch  
​![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/480947fbc19b4f779c7bd6b108fa45fa.png)  
需要注意的是：顺序！！范围大的在最下面。Throwable范围最大！

throw和throws演示

```java
package com.pokes015;

import com.sun.org.apache.bcel.internal.generic.NEW;

public class Demo02 {
    public static void main(String[] args) {
        //调用本类中的方法test,即下面的test
        new Demo02().test(1,0);
    }

    public void test(int a, int b) {
        if (b == 0) {
            throw new ArithmeticException();  //只要b==0，throw就会主动抛出异常
        }
    }


}

```

## IDEA中很重要的快捷键

Ctrl+Alt+T，包裹！选中你需要包裹的内容，然后按快捷键即可选择用什么包裹！

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/fa23e977098c4fb7ba80ebefdf629909.png)
