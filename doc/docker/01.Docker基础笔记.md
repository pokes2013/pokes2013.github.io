# Docker笔记

课程地址：

[www.bilibili.com/video/BV1nW421w7Hc?spm_id_from=333.788.player.s...](https://www.bilibili.com/video/BV1nW421w7Hc?spm_id_from=333.788.player.switch&amp;vd_source=9dc23d072b0edbf78ffed52f1fcb2318&amp;p=10)

‍

## docker安装

首先准备一台centos7把他更新的最新版

### 下载docker安装源

```shell
wget -O /etc/yum.repos.d/docker-ce.repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
```

## ‍安装必要的依赖

```shell
yum install -y yum-utils device-mapper-persistent-data lvm2
```

### 安装docker

```shell
yum install -y docker-ce

# 测试
[root@pokes ~]# docker -v
Docker version 26.1.4, build 5650f9b

#开机启动，并且现在启动
[root@pokes ~]# systemctl enable --now docker
```

这样就安装完成

### 更换镜像拉去源

打开或者新建  
vim /etc/docker/daemon.json   #这个文件如果没有就新建，添加：

```shell

{
        "registry-mirrors" :
         [
        "https://docker.m.daocloud.io",
        "https://noohub.ru",
        "https://huecker.io",
        "https://dockerhub.timeweb.cloud",
        "https://docker.rainbond.cc",
        "https://5tqw56kt.mirror.aliyuncs.com",
        "https://docker.hpcloud.cloud",
        "https://docker.m.daocloud.io",
        "https://docker.1panel.live",
        "http://mirrors.ustc.edu.cn",
        "https://docker.chenby.cn",
        "https://docker.ckyl.me",
        "http://mirror.azure.cn",
        "https://hub.rat.dev",
        "https://docker.rainbond.cc",
        "https://hub.xdark.top",
        "https://hub.littlediary.cn",
        "https://hub.crdz.gq",
        "https://docker.unsee.tech",
        "https://docker.kejilion.pro",
        "https://registry.dockermirror.com",
        "https://hub.rat.dev",
        "https://dhub.kubesre.xyz",
        "https://docker.nastool.de"
         ]
}
```

### <span data-type="text">重启</span>

```shell
systemctl restart docker
```

## docker镜像的管理命令

```shell
docker search mysql  搜索镜像
docker pull mysql  下载镜像
docker images  查看本地镜像
docker rmi -f 8cf625070931  删除镜像
docker rmi -f $(docker images -aq)   #生产环境绝对不能使用此命令，除非你想清空镜像
```

## 容器管理命令

### 查看容器docker ps

```shell
docker ps   查看运行的容器
docker ps -a  列出当前正在运行的容器，和历史运行过的容器，a是all
```

### 运行镜像docker run

下面代码是运行一个简单的nginx容器

```shell
docker run -d -p 81:80 --name web nginx

-d    后台方式运行
-it   使用交互方式运行
-p    指定容器端口，例如：-p 8080:8080
-p    主机端口:容器端口


[root@pokes docker]# docker run -d -p 81:80 --name web nginx
3f25ebe05bcc942e60deccdcb7f4e85bd6915257a64fd7d9f0fe5de31525ddf9

```

docker stats 查看容器的占用

```shell
[root@localhost ~]# docker stats

CONTAINER ID   NAME       CPU %     MEM USAGE / LIMIT     MEM %     NET I/O          BLOCK I/O   PIDS
6cbc8e3b810f   tomcat01   0.18%     111.1MiB / 1.789GiB   6.07%     11.6kB / 138kB   0B / 0B     28

```

限制占用

```shell
docker run -d -p 8080:8080 --name tomcat02 -m 100M tomcat

-m 限制最大占用宿主机内存为100M
```

‍

‍

### 已有容器的操作

```shell
docker start 容器ID号     #启动已经停止的容器
docker restart 容器ID号   #重启容器
docker stop 容器ID号      #停止容器
docker kill 容器ID号      #强制停止容器
docker stop $(docker ps -aq)       #停止所有运行的容器

docker rm 镜像ID/名称：版本号     #删除停止的容器，不能删除正在运行的容器
docker rm -f                    #强制删除容器，可以删除运行的容器
docker rm -f $(docker ps -aq)   #删除所有容器

docker inspect 容器名称/ID

docker logs 容器ID
docker logs -ft --tail 10 容器ID      #显示10条日志

docker inspect 容器ID   #查看容器信息
```

### 进入容器内部

```shell
docker exec -it 7752222e1e1 /bin/bash  
#进入容器并重新开启一个终端，按Ctrl+P+Q键释放终端，容器不会停止

docker attach 容器ID   #进入容器正在执行的终端
docker cp 容器ID:容器内路径 目的的主机路径     #用于拷贝容器内的数据
```

## 容器的持久化挂载

创建启动容器时，使用-v参数 设置数据卷

```shell
docker run ...-v 宿主机的目录：容器内的目录
```

如果挂载的目录不存在会自动创建，一个容器可以挂载多个数据卷

```shell
docker run -d -p 3310:3306 \
-v /home/mysql/conf:/etc/mysql/conf.d \
-v /home/mysql/data:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=123456 \
--name mysql01 mysql:5.7
```

下面的代码可以看到我们挂载的`/home/mysql/data`目录中已经有了数据，是容器生成的。

```shell
[root@pokes ~]# docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7
7ea87c4a8dc01bc436e12c8fab850a4d9e8451ffc7c5756efdfd3cb529c4c85b

[root@pokes data]# ll /home/mysql/data/
总用量 188484
-rw-r-----. 1 polkitd input       56 12月 16 14:25 auto.cnf
-rw-------. 1 polkitd input     1680 12月 16 14:25 ca-key.pem
-rw-r--r--. 1 polkitd input     1112 12月 16 14:25 ca.pem
-rw-r--r--. 1 polkitd input     1112 12月 16 14:25 client-cert.pem
-rw-------. 1 polkitd input     1676 12月 16 14:25 client-key.pem
-rw-r-----. 1 polkitd input     1318 12月 16 14:26 ib_buffer_pool
-rw-r-----. 1 polkitd input 79691776 12月 16 14:26 ibdata1
-rw-r-----. 1 polkitd input 50331648 12月 16 14:26 ib_logfile0
-rw-r-----. 1 polkitd input 50331648 12月 16 14:25 ib_logfile1
-rw-r-----. 1 polkitd input 12582912 12月 16 14:43 ibtmp1
drwxr-x---. 2 polkitd input     4096 12月 16 14:25 mysql
lrwxrwxrwx. 1 polkitd input       27 12月 16 14:25 mysql.sock -> /var/run/mysqld/mysqld.sock
drwxr-x---. 2 polkitd input     8192 12月 16 14:25 performance_schema
-rw-------. 1 polkitd input     1680 12月 16 14:25 private_key.pem
-rw-r--r--. 1 polkitd input      452 12月 16 14:25 public_key.pem
-rw-r--r--. 1 polkitd input     1112 12月 16 14:25 server-cert.pem
-rw-------. 1 polkitd input     1676 12月 16 14:25 server-key.pem
drwxr-x---. 2 polkitd input     8192 12月 16 14:25 sys
```

## 初识Dockerfile

Dockerfile用于构建镜像，即自己制作镜像

‍

‍

‍
