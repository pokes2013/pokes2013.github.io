证书错误，如何修复

你遇到了 Git 操作时的 SSL 证书错误，这类错误通常是由于 SSL 证书未被信任、证书过期、自签名证书无法验证，或网络代理拦截了证书验证导致的。下面提供**临时快速修复**（适合测试 / 内网环境）和**长期安全修复**（适合生产 / 公网环境）两类解决方案，优先推荐长期安全方案以避免安全风险。





### 一、先明确：证书错误的核心原因

常见触发场景：

1. 使用自签名 SSL 证书搭建的私有 Git 仓库（如内网 GitLab/Gitee 企业版）；
2. 系统缺少对应的 CA 根证书（正规证书未被系统信任）；
3. 证书过期或域名与证书绑定信息不匹配；
4. 网络代理（VPN / 代理工具）拦截了 SSL 连接，生成了中间代理证书。

### 二、临时快速修复（跳过证书验证，非安全，仅测试 / 内网使用）

该方法通过关闭 Git 的 SSL 证书验证功能快速绕过错误，**存在中间人攻击风险，严禁在公网 / 生产环境使用**，仅适用于本地测试、内网可信仓库场景。

#### 单次命令跳过证书验证

在 Git 操作命令前添加 `GIT_SSL_NO_VERIFY=true`，示例：

```bash
# 克隆仓库时跳过证书验证
GIT_SSL_NO_VERIFY=true git clone https://your-git-repo-url.git

# 拉取/推送代码时跳过证书验证
GIT_SSL_NO_VERIFY=true git pull
GIT_SSL_NO_VERIFY=true git push
```

#### 全局配置跳过证书验证

```bash
# 开启全局SSL证书验证跳过
git config --global http.sslVerify false

# 若后续需要恢复证书验证（必须执行，保障安全）
git config --global --unset http.sslVerify
# 或重新开启验证
git config --global http.sslVerify true
```

#### 仅对单个仓库跳过证书验证

先进入目标仓库目录，再执行局部配置：

```bash
# 进入仓库目录
cd /path/to/your/local/repo

# 仅当前仓库关闭SSL证书验证
git config --local http.sslVerify false

# 恢复当前仓库的证书验证
git config --local --unset http.sslVerify
```

### 三、长期安全修复（推荐，无安全风险，适用于所有环境）

这是生产环境和公网操作的首选方案，核心是让 Git / 系统信任对应的 SSL 证书。

#### 自签名证书

步骤：获取自签名证书 → 配置 Git 信任该证书

1. **获取自签名证书**方法 1：从 Git 服务器导出（如 GitLab/Gitea，可在浏览器访问仓库地址，点击地址栏锁图标 → 查看证书 → 导出证书文件（格式：.pem 或 .crt））方法 2：通过`openssl`命令提取证书（需安装 openssl 工具）

   ```bash
   # 替换为你的Git仓库域名和端口（默认443）
   openssl s_client -connect your-git-domain:443 < /dev/null | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' > git-cert.pem
   ```

   

   执行后会在当前目录生成`git-cert.pem`证书文件。

2. **配置 Git 信任该证书**可选：全局信任（所有仓库生效）或单个仓库信任

   ```bash
   # 方案1：全局信任该证书（推荐，一次配置所有仓库可用）
   git config --global http.sslCAInfo /path/to/your/git-cert.pem
   
   # 方案2：仅单个仓库信任该证书（进入仓库目录后执行）
   cd /path/to/your/local/repo
   git config --local http.sslCAInfo /path/to/your/git-cert.pem
   ```

   

   注意：替换`/path/to/your/git-cert.pem`为你的证书实际存放路径（绝对路径最佳）。

#### 正规 CA 证书问题

正规公网 Git 仓库（如 GitHub/Gitee）出现证书错误，通常是系统根证书库未更新或缺少对应 CA 证书，解决方案是更新系统根证书：

1. **Windows 系统**自动更新：设置 → Windows 更新 → 检查更新（系统会自动更新根证书库）手动更新：访问微软官方根证书更新页面，下载并安装对应更新包。

2. **Linux 系统**

   - CentOS/RHEL 系列

     ```bash
     # 更新根证书包
     yum install -y ca-certificates
     # 刷新证书缓存
     update-ca-trust extract
     ```

     

   - Ubuntu/Debian 系列

     ```bash
     # 更新根证书包
     apt update && apt install -y ca-certificates
     # 刷新证书缓存
     update-ca-certificates
     ```

     

3. **Mac 系统**方法 1：通过钥匙串信任证书打开「钥匙串访问」→ 导入证书（.pem/.crt）→ 右键证书 → 显示简介 → 信任 → 设置「使用此证书时」为「始终信任」方法 2：更新系统根证书点击苹果菜单 → 关于本机 → 软件更新 → 安装所有可用更新。

#### 网络代理导致的证书错误

若使用 VPN / 代理工具后出现证书错误，是代理工具生成了中间代理证书，解决方案：

1. 导出代理工具的 SSL 证书（参考代理工具官方文档，通常在设置 - SSL / 证书中可导出）；
2. 按照「场景 1 - 步骤 2」将代理证书配置为 Git 信任的证书；
3. 或暂时关闭不必要的代理，直接连接 Git 仓库。

### 四、排查验证：确认证书问题是否解决

执行以下 Git 命令验证修复效果：

```bash
# 查看当前SSL相关配置，确认配置生效
git config --list | grep ssl

# 克隆或拉取仓库测试
git clone https://your-git-repo-url.git
git pull
```

### 总结

1. 临时修复：用 `GIT_SSL_NO_VERIFY=true` 或 `git config --global http.sslVerify false`，仅适用于内网 / 测试环境，用完必恢复；
2. 长期修复：自签名证书需「导出证书 + 配置 Git 信任」，正规证书需「更新系统根证书」，代理导致的需信任代理证书；
3. 安全优先：生产环境和公网操作严禁跳过证书验证，必须采用长期安全方案。

从 Git 服务器导出  ，请问如何导出

你需要从 Git 服务器（对应网页端，如 GitLab、Gitee 企业版、Gitea、GitHub Enterprise 等）导出 SSL 证书，核心是通过 ** 浏览器（Chrome/Edge/Firefox）** 操作，因为浏览器访问 Git 服务器网页时会自动识别证书，以下分主流浏览器提供详细、可落地的导出步骤，同时明确关键注意事项：

### 前提准备

先在浏览器中打开你的 Git 服务器网页地址（如 `https://gitlab.your-company.com`、`https://gitea.internal.net`），确保能正常访问服务器网页（即使提示证书不安全也可操作，仅需进入网页页面）。

## 一、Chrome / Edge 浏览器（基于 Chromium 内核，步骤一致）

这两款浏览器导出证书的流程完全相同，步骤如下：

1. **点击地址栏的「锁形图标」**：在浏览器地址栏左侧，会显示「不安全」（自签名证书）或「安全」（正规证书）的锁形图标，直接点击该图标。
2. **打开证书详情面板**：
   - 若显示「不安全」：点击弹出菜单中的「证书」（部分版本显示「查看证书」）；
   - 若显示「安全」：点击弹出菜单中的「连接是安全的」→ 再点击「证书」。
3. **切换到「详细信息」标签页**：在弹出的证书窗口中，找到并点击「详细信息」（顶部标签栏）。
4. **导出证书**：
   - 点击窗口底部的「复制到文件...」按钮，弹出证书导出向导，点击「下一步」；
   - 选择证书导出格式：推荐选择 `Base64 编码的 X.509 (.CER)`（兼容性最好，Git 可直接识别，对应.pem/.crt 格式），点击「下一步」；
   - 选择保存路径和文件名：自定义保存位置（如桌面，方便查找），文件名可设为 `git-server-cert`（后缀会自动匹配，或手动改为.pem），点击「下一步」；
   - 点击「完成」，提示「导出成功」，此时桌面会生成对应的证书文件（如 git-server-cert.cer 或 git-server-cert.pem）。

## 二、Firefox 浏览器

Firefox 导出流程略有差异，步骤如下：

1. **点击地址栏的「锁形图标」**：同样在地址栏左侧，点击锁形图标（可能显示「⚠️ 不安全」或「🔒 安全」）。
2. **查看证书信息**：
   - 点击弹出菜单中的「更多信息」；
   - 在新打开的页面中，切换到「安全」标签页，点击下方的「查看证书」按钮。
3. **导出证书**：
   - 在证书窗口中，切换到「详细信息」标签页；
   - 选中列表中的最顶层证书（通常是根证书 / 服务器证书，避免选中中间证书）；
   - 点击窗口右侧的「导出...」按钮；
   - 选择保存路径（如桌面），文件名自定义（如 git-cert），**文件格式选择「PEM 证书文件（\*.pem; \*.crt; \*.cer）」**（关键，确保 Git 能识别），点击「保存」即可。

### 三、关键注意事项

1. **证书格式要求**：Git 仅支持 `PEM` 编码格式的证书（后缀为.pem、.crt、.cer 均可，本质格式一致），**切勿选择「PKCS #12」格式**（.pfx/.p12，Git 无法识别），这是导出时的核心要点。
2. **保存路径建议**：优先保存到易查找的绝对路径（如 Windows：`C:\cert\git-server-cert.pem`；Linux/Mac：`/usr/local/cert/git-server-cert.pem`），后续配置 Git 信任证书时需用到该绝对路径。
3. **适用场景**：该方法适用于所有网页端可访问的 Git 服务器（GitLab、Gitee 企业版、Gitea、Bitbucket Server 等），公网 Git 仓库（GitHub/Gitee 公开版）一般无需手动导出（系统已信任其证书），仅内网私有 Git 服务器（自签名证书）需要此操作。
4. **验证证书有效性**：导出后可打开证书文件（用记事本 / 文本编辑器），若能看到 `-----BEGIN CERTIFICATE-----` 和 `-----END CERTIFICATE-----` 字样，说明导出格式正确，可用于 Git 配置。

### 总结

1. 核心工具：通过 Chrome/Edge/Firefox 浏览器访问 Git 服务器网页，即可导出证书；
2. 关键步骤：锁形图标 → 证书详情 → 详细信息 → 导出（选择 PEM/Base64 X.509 格式）；
3. 格式要求：必须是 PEM 编码（.pem/.crt/.cer），避免 PKCS #12 格式，确保 Git 兼容。