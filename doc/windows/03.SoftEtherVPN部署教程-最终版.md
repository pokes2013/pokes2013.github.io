# SoftEtherVPN部署教程-最终版

# 1. SoftEtherVPN部署教程-最终版

## 1.1 **SoftEther VPN 概述**

**官网：**​**[https://www.softether.org/](https://www.softether.org/)**

SoftEther VPN 是日本筑波大学的一个研究项目，是一个开放源代码的跨平台多协议 VPN 程序，它包括服务器端、客户端、服务器端管理工具等数个软件，支持 SSL-VPN (SoftEtherV.PN) 协议、 L2TP/IPsec 协议、 OpenV.PN 协议和 Microsoft SSTP 协议，Windows、Linux、Android 和 IOS 等操作系统都可以连接到 SoftEther VPN 服务器。

## 1.2 注意事项

实践表明，SecureNAT 和 Local Bridge（本地桥）不可以同时开启！否则会造成链路层死循环占用大量 CPU

## 1.3 一、安装与启动服务端

### 1.3.1 1、安装依赖库

```
yum -y install gcc zlib-devel openssl-devel readline-devel ncurses-devel
```

### 1.3.2 2、下载与安装

**通过官网下载：**​****​****​**[http://www.softether-download.com/cn.aspx?product\=softether](http://www.softether-download.com/cn.aspx?product=softether)**

这里以CPU是 Intel x86/Intel x64/AMD64为例，所以我们选择64bit，下载RTM版本

```bash
# 下载
[root@localhost] wget http://www.softether-download.com/files/softether/v4.25-9656-rtm-2018.01.15-tree/Linux/SoftEther_VPN_Server/64bit_-_Intel_x64_or_AMD64/softether-vpnserver-v4.25-9656-rtm-2018.01.15-linux-x64-64bit.tar.gz

# 解压
[root@localhost] tar zxf softether-vpnserver-v4.25-9656-rtm-2018.01.15-linux-x64-64bit.tar.gz
进入解压出来的文件夹
[root@localhost] cd vpnserver/
[root@localhost vpnserver] make	   #会进入安装向导；
```

### 1.3.3 3、启动

```
./vpnserver start   #启动
./vpnserver stop   #停止
./vpncmd   # 命令行管理工具
```

### 1.3.4 ‍4、配置

```bash
[root@localhost vpnserver]# ./vpncmd
vpncmd 命令 - SoftEther VPN 命令行管理工具
SoftEther VPN 命令行管理工具 (vpncmd 命令)
Version 4.41 Build 9787   (Simplified_Chinese)
Compiled 2023/03/14 11:00:03 by buildsan at crosswin with OpenSSL 3.0.7
Copyright (c) 2012-2023 SoftEther VPN Project. All Rights Reserved.

通过使用 vpncmd 程序，可以取得以下成果。

1. VPN Server 或 VPN Bridge 的管理。
2. VPN Client 的管理。
3. 使用 VPN 工具 (证书创建和网络传输速度测试工具)

选择 1, 2 或 3: 1

指定的主机名或目标 VPN Server 或 VPN Bridge 正在 运行的计算机 IP 地址。
通过以 "主机名:端口号" 格式指定，您还可以指定端口号。
(当没有指定端口号时，使用 443。)
如果不输入任何内容并按下回车键，将连接到端口号为 443 的本地主机 (这台电脑)。
目标 IP 地址的主机名:直接回车

如果通过虚拟 HUB 管理模式连接到服务器，请输入虚拟 HUB 的名称。
如果通过服务器管理模式连接，无须输入任何内容请按回车键。
指定虚拟 HUB 名称:直接回车
与服务器 "localhost" 的连接已建立 (端口 443)。

您有整个 VPN Server 的管理员权限。


VPN Server>ServerPasswordSe   #设置管理密码
ServerPasswordSet 命令 - 设置 VPN Server 管理员密码
请输入密码。要取消，请按下 Ctrl + D 键。

密码    : *********
确认输入: *********


命令成功完成。

VPN Server>
crlt+C

 #设为开机自启动
[root@localhost vpnserver]# vi /etc/rc.d/rc.local   #设为开机自启动
在最后添加：
/root/vpnserver/vpnserver start

#给他执行权限，因为在centos7中,/etc/rc.d/rc.local文件的权限被降低了,没有执行权限,需要给它添加可执行权限。
[root@localhost vpnserver]# chmod +x /etc/rc.d/rc.local	
[root@localhost vpnserver]# ./vpnserver start
```

## 1.4 二、管理 SoftEther VPN Server 服务

设置好账号密码之后，我们就可以切换到带有图形界面的设备上配置服务器啦！考虑到 Windows 用户居多，在此我们就以 Window 为例进行讲解（其他版本官网也有下载）。使用windows环境下的远程管理工具vpnsmgr工具来管理VPN服务器

##### 1.4.0.1 工具下载：SoftEther VPN Server manager for windwos

![image-20250618180905800](assets/image-20250618180905800-20250619202036-e5wgy2b.png)

### 1.4.1 1、新建连接

![img](D:\云笔记目录\pokes@163.com\4fb954ce86b54ba485f580a844a4acbc\d6a226fa01984227984157ef5a3f88ad.png)

### 1.4.2 2、配置可视化管理

以下设置名可以随意填写，主机名为我们V.PN服务器的地址，端口号默认走的443端口，使用服务器管理模式来连接，密码是V.PN管理的密码，随后点击确定即可。

注意：centos7默认是打开防护墙的，我们需要把防火墙暂时关闭才能连接

### 1.4.3 3、关闭防火墙

临时关闭

systemctl stop firewalld

禁止开机启动

systemctl disable firewalld

我们之前没有设置端口，那么就是443.

![image-20250618182140601](assets/image-20250618182140601-20250619202036-0dr1zh2.png)

之后选择刚刚新建的设置，点击连接按钮。关闭两个窗口来到主管理界面：

![image-20250618182245344](assets/image-20250618182245344-20250619202036-7gltnsy.png)

### 1.4.4 3、去掉不必要的配置项

更改加密方式，关闭日志发送。

![image-20250618182401480](assets/image-20250618182401480-20250619202036-jzrh6a2.png)

![image-20250618182509210](assets/image-20250618182509210-20250619202036-falmo7k.png)

### 1.4.5 4、新建 Hub

原来的 Hub 名字比较难听，为了体验一把，我们就把原来的 DEFAULT 这个 hub 删掉，然后点击创建虚拟 Hub

![image-20250618182608965](assets/image-20250618182608965-20250619202036-lythb4j.png)

### 1.4.6 5、创建用户

点击管理虚拟 Hub - 管理用户，左下角的新建。输入用户名，可以使用匿名的方式认证、也可以使用账号密码、甚至是证书认证也可以。

安全策略那里可以设置此用户的最大下载速度、最大上传速度，简直是为了商用而准备的！

![image-20250618182713129](assets/image-20250618182713129-20250619202036-v3ilzgw.png)

### 1.4.7 6、配置SecureNAT

开启NAT转换和DHCP服务

**警告请一定要注意，SecureNAT 和 Local Bridge（本地桥）不可以同时开启！**

在 "虚拟 Hub" 界面点击 "虚拟 NAT 和虚拟 DHCP 服务器"

![image-20250618182824444](assets/image-20250618182824444-20250619202036-v5mqnxl.png)

先查看SerureNAT配置，确认没有问题再启用。注意：此功能不能和桥接模式同时开启

### 1.4.8 7、配置VPN

我们是PC对接站点，配置这里，我们后续可以使用openvpn客户端。

![image-20250618183010137](assets/image-20250618183010137-20250619202036-uewyilh.png)

### 1.4.9 8、配置客户端

编辑导出的openvpn配置文件：

```
###############################################################################
# OpenVPN 2.0 Sample Configuration File
# for PacketiX VPN / SoftEther VPN Server
# 
# !!! AUTO-GENERATED BY SOFTETHER VPN SERVER MANAGEMENT TOOL !!!
# 
# !!! YOU HAVE TO REVIEW IT BEFORE USE AND MODIFY IT AS NECESSARY !!!
# 
# This configuration file is auto-generated. You might use this config file
# in order to connect to the PacketiX VPN / SoftEther VPN Server.
# However, before you try it, you should review the descriptions of the file
# to determine the necessity to modify to suitable for your real environment.
# If necessary, you have to modify a little adequately on the file.
# For example, the IP address or the hostname as a destination VPN Server
# should be confirmed.
# 
# Note that to use OpenVPN 2.0, you have to put the certification file of
# the destination VPN Server on the OpenVPN Client computer when you use this
# config file. Please refer the below descriptions carefully.


###############################################################################
# Specify the type of the layer of the VPN connection.
# 
# To connect to the VPN Server as a "Remote-Access VPN Client PC",
#  specify 'dev tun'. (Layer-3 IP Routing Mode)
#
# To connect to the VPN Server as a bridging equipment of "Site-to-Site VPN",
#  specify 'dev tap'. (Layer-2 Ethernet Bridgine Mode)

dev tun


###############################################################################
# Specify the underlying protocol beyond the Internet.
# Note that this setting must be correspond with the listening setting on
# the VPN Server.
# 
# Specify either 'proto tcp' or 'proto udp'.

proto tcp   #使用tcp


###############################################################################
# The destination hostname / IP address, and port number of
# the target VPN Server.
# 
# You have to specify as 'remote <HOSTNAME> <PORT>'. You can also
# specify the IP address instead of the hostname.
# 
# Note that the auto-generated below hostname are a "auto-detected
# IP address" of the VPN Server. You have to confirm the correctness
# beforehand.
# 
# When you want to connect to the VPN Server by using TCP protocol,
# the port number of the destination TCP port should be same as one of
# the available TCP listeners on the VPN Server.
# 
# When you use UDP protocol, the port number must same as the configuration
# setting of "OpenVPN Server Compatible Function" on the VPN Server.

# Note: The below hostname is came from the Dynamic DNS Client function
#       which is running on the VPN Server. If you don't want to use
#       the Dynamic DNS hostname, replace it to either IP address or
#       other domain's hostname.

remote www.pokes.com 5555   #外网地址和端口，端口必须提前做好端口映射。


###############################################################################
# The HTTP/HTTPS proxy setting.
# 
# Only if you have to use the Internet via a proxy, uncomment the below
# two lines and specify the proxy address and the port number.
# In the case of using proxy-authentication, refer the OpenVPN manual.

;http-proxy-retry
;http-proxy [proxy server] [proxy port]


###############################################################################
# The encryption and authentication algorithm.
# 
# Default setting is good. Modify it as you prefer.
# When you specify an unsupported algorithm, the error will occur.
# 
# The supported algorithms are as follows:
#  cipher: [NULL-CIPHER] NULL AES-128-CBC AES-192-CBC AES-256-CBC BF-CBC
#          CAST-CBC CAST5-CBC DES-CBC DES-EDE-CBC DES-EDE3-CBC DESX-CBC
#          RC2-40-CBC RC2-64-CBC RC2-CBC CAMELLIA-128-CBC CAMELLIA-192-CBC CAMELLIA-256-CBC
#  auth:   SHA SHA1 SHA256 SHA384 SHA512 MD5 MD4 RMD160

cipher AES-128-CBC
auth SHA1


###############################################################################
# Other parameters necessary to connect to the VPN Server.
# 
# It is not recommended to modify it unless you have a particular need.

resolv-retry infinite
nobind
persist-key
persist-tun
client
verb 3

###############################################################################
# Authentication with credentials.
# 
# Comment the line out in case you want to use the certificate authentication.

auth-user-pass


###############################################################################
# The certificate file of the destination VPN Server.
# 
# The CA certificate file is embedded in the inline format.
# You can replace this CA contents if necessary.
# Please note that if the server certificate is not a self-signed, you have to
# specify the signer's root certificate (CA) here.

<ca>
-----BEGIN CERTIFICATE-----
MIIEUDCCAzigAwIBAgIBADANBgkqhkiG9w0BAQsFADCBpjExMC8GA1UEAwwoX3Vu
cmVnaXN0ZXJlZF92cG44ODM1NzU5Nzcuc29mdGV0aGVyLm5ldDExMC8GA1UECgwo
X3VucmVnaXN0ZXJlZF92cG44ODM1NzU5Nzcuc29mdGV0aGVyLm5ldDExMC8GA1UE
CwwoX3VucmVnaXN0ZXJlZF92cG44ODM1NzU5Nzcuc29mdGV0aGVyLm5ldDELMAkG
A1UEBhMCVVMwHhcNMjUwNjE4MDIyMTAxWhcNMzcxMjMxMDIyMTAxWjCBpjExMC8G
A1UEAwwoX3VucmVnaXN0ZXJlZF92cG44ODM1NzU5Nzcuc29mdGV0aGVyLm5ldDEx
MC8GA1UECgwoX3VucmVnaXN0ZXJlZF92cG44ODM1NzU5Nzcuc29mdGV0aGVyLm5l
dDExMC8GA1UECwwoX3VucmVnaXN0ZXJlZF92cG44ODM1NzU5Nzcuc29mdGV0aGVy
Lm5ldDELMAkGA1UEBhMCVVMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB
AQC+F1PhprpyxIrJIVwo4bfkJUUGA5f44d4TnfqaVq82UjesNeiim2urMQyv15X6
8ukwsKt8TNPNJRtSP4jqchFC3EpdpdtSoOarE3DEEhVZUe9CweVe7deA8xPCNZMj
k72tLM0VzlaQTLWM2z3sbS2bUCEfxme2BU02NrR8BszDG2qY6h/uHGUqidevkPy1
OhJyr1cbJBPuMl8EBhxiUG2fGAOroPQPB/Nb4liwfpWwXn/FlEUF8l2uWquEEGde
Te9qJI4aZAl0iGcvT0qRp1Da06jGFKhCoGAG9yh2Z8Eu7iRpwi6XpCkO4+ZbwzAm
ueCsK1KDNMsi495LUj2oIUdlAgMBAAGjgYYwgYMwDwYDVR0TAQH/BAUwAwEB/zAL
BgNVHQ8EBAMCAfYwYwYDVR0lBFwwWgYIKwYBBQUHAwEGCCsGAQUFBwMCBggrBgEF
BQcDAwYIKwYBBQUHAwQGCCsGAQUFBwMFBggrBgEFBQcDBgYIKwYBBQUHAwcGCCsG
AQUFBwMIBggrBgEFBQcDCTANBgkqhkiG9w0BAQsFAAOCAQEAP+oGYzAXDLE4xM88
Q7NKlHLFkhIzVE6sPWeAZkoJ2I5oWj308D5rEQ2vZAXTwfRjyK0h/05G7ntqm5my
7CyKrM5AbovNdcvFwSqNHp+bMW0xUnO3pgV3l+YECrMSZ4LN4jSZba7YDHlwjrNk
AsoeVa6iiiua0A3q5aQIUwr3Gc7J89bE4jl1RSVm9AtDVOesakNZyZdR5M5Pz5fX
x5cN9z9ubkHPo/grthhtyjuykuikuikbcvbcc9W0XBtOaAefVKOwoadAM2Jmuw3L
z6SyuHMjEifA3SIIVFgXdc75BBGOnDkD9uSK2sqASt3UkGGI63/gHGyvzouQboRl
BO5BLQ==
-----END CERTIFICATE-----

</ca>


###############################################################################
# Client certificate and key.
# 
# A pair of client certificate and private key is required in case you want to
# use the certificate authentication.
# 
# To enable it, uncomment the lines below.
# Paste your certificate in the <cert> block and the key in the <key> one.

;<cert>
;-----BEGIN CERTIFICATE-----
;
;-----END CERTIFICATE-----
;</cert>

;<key>
;-----BEGIN RSA PRIVATE KEY-----
;
;-----END RSA PRIVATE KEY-----
;</key>



```
