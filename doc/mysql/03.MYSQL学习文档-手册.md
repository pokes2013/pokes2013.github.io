# MYSQL学习文档-手册



MySQL 文档整理

参考资料：

>  MySQL目录的介绍，windwos安装绿色版的MySQL https://www.cnblogs.com/robertx/p/10291953.html 
>
>  https://www.cnblogs.com/yanjieli/p/9778920.html



## 一、.Mysql编译安装

### 1.1 环境介绍

 **当前环境是虚拟机中最小化安装的Centos7, 防火墙开启状态。 安装Mysql5.5.62仅用于学习** 

```bash
[root@localhost MySQL-5.5.62]# uname -a
Linux localhost.localdomain 3.10.0-693.el7.x86_64 #1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
[root@localhost MySQL-5.5.62]# cat /etc/centos-release
CentOS Linux release 7.7.1908 (Core)
[root@localhost MySQL-5.5.62]# 
```

### 1.2 检查冲突

 查看是否存在`mariadb` 、旧的mysql

```bash
rpm -qa | grep mariadb
rpm -qa | grep mysql
rpm -e --nodeps 包全名
存在/etc/my.cnf，则需要先删除
```

### 1.3 安装依赖

```bash
[root@localhost ~]# yum -y install make gcc-c++ cmake bison-devel ncurses-devel perl openssl-devel autoconf
```

-  mysql5.5之后需要用cmake支持编译安装 
-  openssl-devel 编译时需要，要不然会报错
-  autoconf  此包安装时会安装Data:Dumper模块 ， 数据库初始化 时需要Dumpe

### 1.4 准备用户和组

```bash
[root@localhost ~]# groupadd mysql
[root@localhost ~]# useradd mysql -g mysql -M -s /sbin/nologin
```

### 1.5 下载源码包

怎么下载这里就不说了

```bash
[root@localhost ~]# tar -zxvf mysql-5.6.46.tar
[root@localhost ~]# cd mysql5.6.46
```

### 1.6 开始编译

```bash
cmake \
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
-DMYSQL_DATADIR=/usr/local/mysql/data \
-DSYSCONFDIR=/etc \
-DWITH_MYISAM_STORAGE_ENGINE=1 \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_MEMORY_STORAGE_ENGINE=1 \
-DWITH_READLINE=1 \
-DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \
-DMYSQL_TCP_PORT=3306 \
-DENABLED_LOCAL_INFILE=1 \
-DWITH_PARTITION_STORAGE_ENGINE=1 \
-DEXTRA_CHARSETS=all \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci
```

 我在这里编译时报错：

```bash
CMake Error at cmake/ssl.cmake:66 (MESSAGE):
Please install the appropriate openssl developer package.
Call Stack (most recent call first):
cmake/ssl.cmake:260 (FATAL_SSL_NOT_FOUND_ERROR)
CMakeLists.txt:482 (MYSQL_CHECK_SSL)
```

 出现这个原因时：==需要安装openssl-devel 这个依赖==

#如果需要重新编译还需要删除`CMakeCache.txt`才能重新编译。

```bash
rm -rf CMakeCache.txt
```

### 1.7 编译完成后安装

```bash
make && make install
```

 时间约20分钟 

### 1.8 目录授权

```bash
chown mysql:mysql /usr/local/mysql
```

### 1.9 安全初始化

此处注意执行脚本的方式和初始化参数的正确性，不然会造成初始化的不成功，不会创建mysql库。注意仔细看初始化的成功提示。 

```bash
cd /usr/local/mysql
./scripts/mysql_install_db --user=mysql --datadir=/usr/local/mysql/data
```

 报错： 

```ini
FATAL ERROR: please install the following Perl modules before executing ./scripts/mysql_install_db:
Data::Dumper
```

> 查阅资料，解决方法如下：安装autoconf库
> `yum -y install autoconf`   #此包安装时会安装Data:`Dumper模块`
>
> 安装完成后，再次运行上面脚本命令成功

### 2.0 修改配置文件

配置前先必须从解压的源码包目录内拷贝配置文件到etc目录下，my.cnf是mysql的主配置文件

```bash
cp support-files/my-default.cnf /etc/my.cnf
vim /etc/my.cnf
 
[mysqld] 添加：
datadir=/usr/local/mysql/data
default-storage-engine=InnoDB
lower_case_table_names=1
```

### 2.2 环境变量

```bash
vim /root/.bash_profile
PATH=$PATH:$HOME/bin为：
在默认的变量冒号后面添加下面两个路径：
/usr/local/mysql/bin
/usr/local/mysql/lib
最终效果：
PATH=$PATH:$HOME/bin:/usr/local/mysql/bin:/usr/local/mysql/lib
```

刷新配置 

```bash
source /root/.bash_profile      #使刚才的修改生效
```

### 2.3 传统方式启动

```bash
bin/mysqld_safe --user=mysql &
```

报错1：

```ini
运行上面63行命令遇到问题：-bash: mysqld_safe: command not found
```



> 查找到的解决方案：
>
> 原因:这是由于系统默认会查找`/usr/bin`下的命令，如果这个命令不在这个目录下，当然会找不到命令，我们需要做的就是映射一个软链接到/usr/bin目录下，相当于建立一个链接文件。
>
> 首先得知道mysql命令或mysqladmin命令的完整路径，比如mysql的路径是：`/usr/local/mysql/bin/mysql`

```bash
ln -s /usr/local/mysql/bin/mysql* /usr/bin
mysqld_safe --user=mysql --skip-grant-tables --skip-networking &
```

报错2：

```ini
200601 15:39:52 mysqld_safe error: log-error set to '/var/log/mariadb/mariadb.log', however file don't exists. Create writable for user 'mysql'.
```

> 解决：根据提示，只需要在对应的目录下创建报错中指定的文件，即：
> `cd /var/log/`
> `mkdir mariadb`
> `cd mariadb/`
> `touch mariadb.log`
> 重新尝试启动服务，该问题解决。

报错3：

```ini
200602 19:59:38 mysqld_safe Logging to '/usr/local/mysql/data/pokes01.err'.
200602 19:59:38 mysqld_safe Starting mysqld daemon with databases from /usr/local/mysql/data
```

> 解决方法：
>
> 查看`/etc/my.cnf` 下的`[mysqld]`中有没有`datadir=/usr/local/mysql/data/` 数据目录的路径，如果没有填上。
>
> 然后在进行数据库初始化。即可

初始化数据库之后就可以登录了。mysql5.6以前的版本是没有密码的，直接回车即可登录：

```bash
mysql -uroot -p
```

### 2.4 制作服务启动

```bash
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql
```

相关的命令：

- service mysql start
- service mysql restart
- service mysql enable

有点像centos6启动服务

### 2.5 密码修改开启远程访问

```sql
[root@localhost mysql]# mysql -u root mysql
mysql> use mysql;
mysql> desc user;
mysql> GRANT ALL PRIVILEGES ON *.* TO root@"%" IDENTIFIED BY "root"; //为root添加远程连接的能力
mysql> update user set Password = password('123456') where User='root'; //设置root用户密码
mysql> select Host,User,Password from user where User='root';
mysql> flush privileges;
mysql> exit
```

**远程访问报错**

在这里我在开启远程访问之后，还是出现了问题：

用sqlyog登录出现登录被拒绝，提示错误1045问题？？

```ini
1045    Access denied for user 'root'@'%' (using password:YES)
```

解决方法：

进入MySQL的安装目录，找到自己的MySQL的`my.cnf`文件。找到`[mysqld]`关键字，下面添加`skip-grant-tables`。然后保存重启MySQL即可。

## 二、Mysql目录的介绍

### 2.1 mysql安装目录

```bash
[root@localhost mysql]# ll
总用量 48
drwxr-xr-x  2 root  root   4096 9月   3 22:03 bin
-rw-r--r--  1 root  root  17987 11月 28 2016 COPYING
drwxr-xr-x  5 mysql mysql   192 9月   4 09:26 data
drwxr-xr-x  2 root  root     55 9月   3 22:02 docs
drwxr-xr-x  3 root  root   4096 9月   3 22:02 include
drwxr-xr-x  3 root  root    291 9月   3 22:03 lib
drwxr-xr-x  4 root  root     30 9月   3 22:03 man
-rw-r--r--  1 root  root    943 9月   3 22:06 my.cnf
drwxr-xr-x 10 root  root   4096 9月   3 22:03 mysql-test
-rw-r--r--  1 root  root   2496 11月 28 2016 README
drwxr-xr-x  2 root  root     30 9月   3 22:03 scripts
drwxr-xr-x 28 root  root   4096 9月   3 22:03 share
drwxr-xr-x  4 root  root   4096 9月   3 22:03 sql-bench
drwxr-xr-x  2 root  root    136 9月   3 22:03 support-files
```



- bin，存储可执行文件，mysql自带客户端，mysql服务端
- data，存放数据的文件
- docs，存放一些文档
- include，存放包含的头文件
- lib ，存储库文件 
- my.cnf，配置文件 
- share ，错误信息和字符集文件等

 没有介绍到的，了解一下就可以了



### 2.2 数据存储目录

其中，我们重点看一下data文件夹：如果你找不到自己建立的库或者表的文件，可能不在这个data文件夹下面，连接上mysql之后，输入

```mysql
show global variables like "%datadir%";
```

来查看数据文件存储路径，找到路径之后，到对应路径下如果找不到这个文件夹，那么可能是隐藏的，把隐藏的文件显示一下就行了。

```mysql
mysql> show global variables like "%datadir%";    #查询数据库的存储路径
+---------------+------------------------+
| Variable_name | Value                  |
+---------------+------------------------+
| datadir       | /usr/local/mysql/data/ |
+---------------+------------------------+
1 row in set (0.01 sec)

mysql> 
```

上面的`datadir：/usr/local/mysql/data/`就是数据存储的目录，备份也是备份这个目录。

下图是data目录的数据：

```bash
[root@localhost data]# ll
总用量 110624
-rw-rw---- 1 mysql mysql       56 9月   3 22:09 auto.cnf
-rw-rw---- 1 mysql mysql 12582912 9月   4 09:26 ibdata1
-rw-rw---- 1 mysql mysql 50331648 9月   4 09:26 ib_logfile0
-rw-rw---- 1 mysql mysql 50331648 9月   3 22:06 ib_logfile1
-rw-rw---- 1 mysql mysql    12345 9月   4 09:27 localhost.localdomain.err
-rw-rw---- 1 mysql mysql        7 9月   4 09:26 localhost.localdomain.pid
drwx------ 2 mysql mysql     4096 9月   3 22:06 mysql
drwx------ 2 mysql mysql     4096 9月   3 22:06 performance_schema
drwxr-xr-x 2 mysql mysql       20 9月   3 22:03 test
```

我们再来看看数据库中的库：

```mysql
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| test               |
+--------------------+
4 rows in set (0.04 sec)
```

根据上两张图不难发现一个规律。在mysql中一个库对应1个目录。`information_schema`这个是内存中的1个库。

### 2.3 mysql库的说明

其中mysql这个库：

mysql：这个是`mysql`整个服务的核心数据库，类似于sql server中的master表，主要负责存储数据库的用户、权限设置、关键字等mysql自己需要使用的控制和管理信息。不可以删除，如果对mysql不是很了解，也不要轻易修改这个数据库里面的表信息。

其实这些库就是我们电脑上对应的文件夹，在mysql中显示为对应的库，来方便我们管理数据，而文件或者文件夹这种与硬盘打交道的事情就交给mysql了，我们只需要对mysql库中的数据进行操作就可以了，你可以看到，我们刚才简单使用的时候创建的一个crm库，也就是在data目录下的生成了一个crm文件夹。

## 三、mysql的管理

### 3.1 权限操作

```sql
mysql -h192.168.0.100 -u  －p123456   #登录到默认端口

set password=password('123456');  #更改密码为123456
show global variables like "%datadir%";   #查询存储路径
```

**修改密码**

格式：mysqladmin -u用户名 -p旧密码 password 新密码 

```sql
mysqladmin -u root password ab12
mysqladmin -u root -p ab12 password djg345
```


注：因为开始时root没有密码，所以-p旧密码一项就可以省略了。 

**增加新用户**

 注意：和上面不同，下面的因为是MYSQL环境中的命令，所以后面都带一个分号作为命令结束符 

 格式：grant select on 数据库.* to 用户名@登录主机 identified by “密码” 

**举例01**：增加一个用户test1密码为abc，让他可以在任何主机上登录，并对所有数据库有查询、插入、修改、删除的权限。首先用root用户连入MYSQL，然后键入以下命令：

```sql
grant select,insert,update,delete on *.* to [email=test1@”%]test1@”%[/email]” Identified by “abc”;
```

 但增加的用户是十分危险的，你想如某个人知道test1的密码，那么他就可以在internet上的任何一台电脑上登录你的mysql数据库并对你的数据可以为所欲为了，解决办法见2。 

**举例02：**增加一个用户test2密码为abc,让他只可以在localhost上登录，并可以对数据库mydb进行查询、插入、修改、删除的操作（localhost指本地主机，即MYSQL数据库所在的那台主机），这样用户即使用知道test2的密码，他也无法从internet上直接访问数据库，只能通过MYSQL主机上的web页来访问了。

```sql
grant select,insert,update,delete on mydb.* to [email=test2@localhost]test2@localhost[/email] identified by “abc”;
```

 如果你不想test2有密码，可以再打一个命令将密码消掉。 

```sql
grant select,insert,update,delete on mydb.* to [email=test2@localhost]test2@localhost[/email] identified by “”;
```

### 3.2 库的操作

**新建库**

```sql
CREATE DATABASE test; 
```

**查看库**

```sql
SHOW DATABASES;   查看数据库中有哪些库
```

**查看数据库的信息**

```sql
SHOW CREATE DATABASE test;    查看test库的创建信息，信息中包含编码方式
```

**修改数据库编码方式**

```sql
ALTER DATABASE 数据库名 DEFAULT CHARACTER SET 编码方式 COLLATE 编码方式_bin 

例如：ALTER DATABASE test DEFAULT CHARACTER SET gbk COLLATE gbk_bin
```

**删除库**

```sql
DROP DATABASE test;   删除库test
```

**查看库中的表**

```sql
show tables；
```

### 3.3 表的操作

**表的创建**

CREATE TABLE 语句用于创建数据库中的表。表由行和列组成，每个表都必须有个表名。

```sql
CREATE TABLE table_name                
(                
column_name1 data_type(size),                
column_name2 data_type(size),                
column_name3 data_type(size),                
....                
);
```

其中：
　column_name 参数规定表中列的名称。
　data_type 参数规定列的数据类型（例如 varchar、integer、decimal、date 等等）。
　size 参数规定表中列的最大长度。

**实例：建立一张学生表**

```sql
USE test   #明确位置是在test库中建这张表
CREATE TABLE student (id INT ( 11 ),NAME VARCHAR ( 20 ),GRADE FLOAT)
```

student 是表名，id 、NAME、GRADE（学号、姓名、年纪） 分别是字段，跟在字段后面的参数叫做 “字段类型”。

对于初学者而言，可能比较喜欢这种单行版：

```sql
CREATE TABLE student (id INT ( 11 ),NAME VARCHAR ( 20 ),GRADE FLOAT)
```

但是在工作和生产中，必须要写成如下这样，要==养成这样的习惯==：

```sql
CREATE TABLE student ( 
	id INT ( 11 ), 
	NAME VARCHAR ( 20 ), 
	GRADE FLOAT 
)
```

**表的属性的查询**

有时备份时候，需要查看。

```sql
mysql> use hanligang;
Database changed
mysql> DESC tscore;    #查询表的属性
+-----------+--------------+------+-----+---------+-------+
| Field     | Type         | Null | Key | Default | Extra |
+-----------+--------------+------+-----+---------+-------+
| StudentID | varchar(255) | YES  |     | NULL    |       |
| subJectID | varchar(255) | YES  |     | NULL    |       |
| mark      | varchar(255) | YES  |     | NULL    |       |
+-----------+--------------+------+-----+---------+-------+
3 rows in set (0.00 sec)

mysql> DESC tstudent;
+-----------+--------------+------+-----+---------+-------+
| Field     | Type         | Null | Key | Default | Extra |
+-----------+--------------+------+-----+---------+-------+
| StudentID | varchar(255) | YES  |     | NULL    |       |
| Sname     | varchar(255) | YES  |     | NULL    |       |
| sex       | varchar(255) | YES  |     | NULL    |       |
| cardID    | varchar(255) | YES  |     | NULL    |       |
| Birthday  | varchar(255) | YES  |     | NULL    |       |
| Email     | varchar(255) | YES  |     | NULL    |       |
| Class     | varchar(255) | YES  |     | NULL    |       |
| enterTime | varchar(255) | YES  |     | NULL    |       |
+-----------+--------------+------+-----+---------+-------+
8 rows in set (0.00 sec)

mysql> 
mysql> DESC tsubject;
+-------------+--------------+------+-----+---------+-------+
| Field       | Type         | Null | Key | Default | Extra |
+-------------+--------------+------+-----+---------+-------+
| subJectID   | varchar(255) | YES  |     | NULL    |       |
| subJectName | varchar(255) | YES  |     | NULL    |       |
| BookName    | varchar(255) | YES  |     | NULL    |       |
| Publisher   | varchar(255) | YES  |     | NULL    |       |
+-------------+--------------+------+-----+---------+-------+
4 rows in set (0.01 sec)

mysql> 

```

**主键**

主键是什么？有什么特征？

“主键（PRIMARY KEY）”的完整称呼是“主键约束”。MySQL主键约束是一个列或者列的组合，其值能唯一地标识表中的每一行。这样的一列或多列称为表的主键，通过它可以强制表的实体完整性。

1、主键字段存储的值不能重复，因此主键可以唯一标识一行数据(ID、身份证都是唯一的）
2、一个表只能有一个主键
3、主键自动设置为`NOT NULL`（非空）
4、主键是非必须的，也就是一个表可以不声明主键字段

```sql
<字段名><类型> primary key（pu rua rui k )
```

实例：

```sql
CREATE TABLE student ( 
	id INT ( 11 ) PRIMARY KEY, 
	NAME VARCHAR ( 20 ), 
	GRADE FLOAT 
)
```

上例中  id INT ( 11 ) 后面`PRIMARY KEY`，就是设置id为主键，因为在学生表中，名字可以重复，年纪可以相同，但学号和身份证一样是唯一的不可能重复。

## 四、 字段类型

https://blog.csdn.net/annita2019/article/details/103547988

主要包括以下五大类：

- 整数类型：BIT、BOOL、TINY INT、SMALL INT、MEDIUM INT、 INT、 BIG INT

- 浮点数类型：FLOAT、DOUBLE、DECIMAL

- 字符串类型：CHAR、VARCHAR、TINY TEXT、TEXT、MEDIUM TEXT、LONGTEXT、TINY BLOB、BLOB、MEDIUM BLOB、LONG BLOB

- 日期类型：Date、DateTime、TimeStamp、Time、Year

- 其他数据类型：BINARY、VARBINARY、ENUM、SET、Geometry、Point、MultiPoint、LineString、MultiLineString、Polygon、GeometryCollection等

### 4.1、整型

| MySQL数据类型 | 含义（有符号）                       |
| ------------- | ------------------------------------ |
| tinyint(m)    | 1个字节 范围(-128~127)               |
| smallint(m)   | 2个字节 范围(-32768~32767)           |
| mediumint(m)  | 3个字节 范围(-8388608~8388607)       |
| int(m)        | 4个字节 范围(-2147483648~2147483647) |
| bigint(m)     | 8个字节 范围(+-9.22*10的18次方)      |

取值范围如果加了unsigned，则最大值翻倍，如tinyint unsigned的取值范围为(0~256)。

 int(m)里的m是表示SELECT查询结果集中的显示宽度，并不影响实际的取值范围，没有影响到显示的宽度，不知道这个m有什么用。

### 4.2、浮点型

| MySQL数据类型 | 含义                                             |
| ------------- | ------------------------------------------------ |
| float(m,d)    | 单精度浮点型  8位精度(4字节)   m总个数，d小数位  |
| double(m,d)   | 双精度浮点型  16位精度(8字节)   m总个数，d小数位 |

设一个字段定义为float(6,3)，如果插入一个数123.45678,实际数据库里存的是123.457，但总个数还以实际为准，即6位。整数部分最大是3位，如果插入数12.123456，存储的是12.1234，如果插入12.12，存储的是12.1200.

### 4.3、定点数

浮点型在数据库中存放的是近似值，而定点类型在数据库中存放的是精确值。 

decimal(m,d) 参数m<65 是总个数，d<30且 d<m 是小数位。

### 4.4、字符串

| MySQL数据类型 | 含义                            |
| ------------- | ------------------------------- |
| char(n)       | 固定长度，最多255个字符         |
| varchar(n)    | 固定长度，最多65535个字符       |
| tinytext      | 可变长度，最多255个字符         |
| text          | 可变长度，最多65535个字符       |
| mediumtext    | 可变长度，最多2的24次方-1个字符 |
| longtext      | 可变长度，最多2的32次方-1个字符 |

**char和varchar**

1.char(n) 若存入字符数小于n，则以空格补于其后，查询之时再将空格去掉。所以char类型存储的字符串末尾不能有空格，varchar不限于此。 

2.char(n) 固定长度，char(4)不管是存入几个字符，都将占用4个字节，varchar是存入的实际字符数+1个字节（n<=255）或2个字节(n>255)，所以varchar(4),存入3个字符将占用4个字节。 

3.char类型的字符串检索速度要比varchar类型的快。
varchar和text： 

- varchar可指定n，text不能指定，内部存储varchar是存入的实际字符数+1个字节（n<=255）或2个字节(n>255)，text是实际字符数+2个字节。 
- text类型不能有默认值。 
- varchar可直接创建索引，text创建索引要指定前多少个字符。varchar查询速度快于text,在都创建索引的情况下，text的索引似乎不起作用。



### 4.5、二进制数据

1._BLOB和_text存储方式不同，_TEXT以文本方式存储，英文存储区分大小写，而_Blob是以二进制方式存储，不分大小写。

2._BLOB存储的数据只能整体读出。 

3._TEXT可以指定字符集，_BLO不用指定字符集。

### 4.6.日期时间类型

| MySQL数据类型 | 含义                          |
| ------------- | ----------------------------- |
| date          | 日期 '2008-12-2'              |
| time          | 时间 '12:25:36'               |
| datetime      | 日期时间 '2008-12-2 22:06:44' |
| timestamp     | 自动存储记录修改时间          |

若定义一个字段为timestamp，这个字段里的时间数据会随其他字段修改的时候自动刷新，所以这个数据类型的字段可以存放这条记录最后被修改的时间。





## 五、MySQL之字符集

https://www.cnblogs.com/yanjieli/p/9778920.html

## 六、数据库的备份与恢复

### 6.1 逻辑备份

mysqldump命令的使用

需要注意的是mysqldump备份使用的是linux命令，不是MySQL命令。不要进入到数据库里面去敲下面的命令。

**备份整个库**

```bash
mysqldump -u root -p 数据库名 > /备份路径/备份文件名
```

操作实例：

```sql
[root@localhost mysql]# mysqldump -uroot -p hangligang_data >/root/hangligang20200905.sql
Enter password: 
```

如果报错：mysqldump: Got error: 1049: Unknown database 'hangligang_data' when selecting the database

这里出现报错。是在命令末尾多加了分号。

==这里有个知识点：没有进入mysql就不用加分号这是linux命令，不是sql语句。==

**删除原有的库**

删除原有的hanligang_data这个库，并创建新的hanligang的库

```sql
mysql> DROP DATABASE hanligang_data;   #删除hanligang_data这个库
Query OK, 3 rows affected (0.01 sec)

mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |					hanligang_data这个库已经没有了
| test               |
+--------------------+
4 rows in set (0.00 sec)

mysql> CREATE DATABASE hanligang;		创建另外1个叫hanligang的库
Query OK, 1 row affected (0.00 sec)

mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| hanligang          |					创建成功，待会我们要把备份的数据导入到这个库
| mysql              |
| performance_schema |
| test               |
+--------------------+
5 rows in set (0.00 sec)
```



**导入备份的数据**

注意：导入前必须先创建hanligang这个库

```sql
[root@localhost mysql]# mysql hanligang < /root/hangligang20200905.sql
```

进入数据库查看，确认有没有导入

```sql
mysql> use hanligang;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables;
+---------------------+
| Tables_in_hanligang |
+---------------------+
| tscore              |
| tstudent            |
| tsubject            |
+---------------------+
3 rows in set (0.00 sec)
```

==注意提示：在这里容易出现以下问题！！！==

打开数据库是发现提示：

```sql
mysql> use hanligang;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A
```

出现问题的原因是 :
我们进入mysql 时，没有使用-A参数；
即我们使用mysql -hhostname -uusername -ppassword -Pport 的方式进入数据，
而没有使用mysql -hhostname -uusername -ppassword -Pport  -A的方式进入数据库。

当我们打开数据库，即`use hanligang;`时，要预读数据库信息，当使用-A参数时，就不预读数据库信息。

关键的因素是你的数据库变大了。系统变慢了。

这种提示就是数据库还在读取中，过一会就好了。至于等待多长时间，要看你的服务器性能和数据库大小。

```sql
mysql> use hanligang;
Database changed
mysql> show tables;
+---------------------+
| Tables_in_hanligang |
+---------------------+
| tscore              |
| tstudent            |
| tsubject            |
+---------------------+
3 rows in set (0.00 sec)
```

**数据表的备份与恢复**

```sql
mysqldump -u root -p 数据库名 表名 > /备份路径/备份文件名
mysqldump -u root -p 数据库名 表名 < /备份路径/备份文件名
```

### 6.2 物理备份

物理备份，就是直接复制数据库文件。一般适用于大型数据库环境，不受存储引擎的限制，但不能恢复到不同的MySQL版本。一般利用`tar,cp,scp`等命令。拷贝数据，  优点快，缺点服务停止。

备份对象：databases、Binlog、my.cnf

```sql
###########备份的过程###########
1. 停止数据库
systemctl stop mysqld
mkdir /backup
准备目录，放置备份数据。

2. tar备份数据
tar -cf /backup/`date +%F`-mysql-all.tar /var/lib/mysql
注：备份文件应该复制其它服务器或存储上

3. 启动数据库
systemctl start mysqld
			
###########还原的过程###########
1. 停止数据库
systemctl stop mysqld
2. 清理环境（模拟损坏）
rm -rf /var/lib/mysql/*
3. 导入备份数据
tar -xf /backup/2016-12-07-mysql-all.tar -C /
注意权限chown -R mysql.mysql
4. 启动数据库
systemctl start mysqld
5. binlog恢复（略）
注意，从备份点，到崩溃点 之间的数据无法回复，通过bin回复。
```



## 七、Mysql的基本查询语句

select查询语句的语法

```sql
语法：select 列名称 from 表名称     （其中  * 代表选择显示全部的列）
```

无条件查询

```sql
select * from zhprny   即：查询zhprny这个表中的所有列
```

带条件查询

语法 :  `select 列名称 from 表名称 where 列 运算符 值`
运算符有=、<=、！=、>=、<、>、<>、like、between

常用的条件查询就是使用where查询

### 7.1 使用等号指定行

**主要是等号的使用**

请查询：名字叫'吕宁言'的学生的姓名、性别、身份证号、邮箱？

```sql
SELECT Sname,sex,cardID,Birthday,Email FROM TStudent WHERE Sname='吕宁言'
```

查询zhprny这个表中name='张三'的所有列，张三是字符串要用单引号，要英文的单引号。

```sql
SELECT * FROM zhprny WHERE name='张三'   
```

### 7.2 使用运算符过滤数据

使用比较操作符 = > < >= <= <>

请查询：查询分数小于60的学生ID？

```sql
select * from TScore select * from TScore where mark<=60
```

### 7.3 使用逻辑操作符

**AND的使用**

前后两个条件需要全部成立

查询TitleOfCourtesy='Mr.' 并且 LastName='Buchanan'

```sql
SELECT * FROM TStudent WHERE Sname='曹园贞' AND Class='测试' AND sex='女' 
```

**OR的使用**

前后任意一个条件成立即可

```sql
SELECT * FROM TStudent WHERE Sname='曹园贞' OR Sname='邓咏桂'
```

**like的使用**

查询LastName首字母为F的数据

```sql
select * from TStudent where sname like '高%' select * from TStudent where sname like '高%' 
select * from TStudent where sname like '高%' select * from TStudent where sname not like '高%' #反向
```

### 7.4 查询在一定范围内的值

**between的使用**

查询EmployeeID 在1到9之间的数据(包含1和9）

```sql
select EmployeeID,LastName,FirstName
from Employees
where EmployeeID between 1 and 9
```

查询分数≥70，≤等于80的学生信息

```sql
select * from TScore where mark between 70 and 80 
等价于 
select * from TScore where mark>=70 and mark<=80
```

包含两头，包含70和80

### 7.5 查询未知的值空值

查找班级为空的学生

```sql
select * from TStudent where Class is null
```

查找班级不为空的学生

```sql
select * from TStudent where Class is not null
```

### 7.6 格式化结果集

#### 查询结果排序

ORDER BY 语句用于对结果集进行排序。

```sql
select StudentID,subJectID,mark from dbo.TScore order by 2,3 desc
select StudentID,subJectID,mark from dbo.TScore order by subJectID,mark desc
```

asc 升序，desc 降序

#### 消除重复的行

distinct的使用

```sql
select distinct Class from TStudent
```

#### 改变字段的名字

给查询结果的列名称进行重命名

```sql
SELECT
	StudentID AS '学号',
	Sname AS '姓名',
	sex AS '性别',
	cardID AS '身份证号',
	Birthday AS '生日',
	Email AS '邮件',
	Class AS '专业',
	enterTime AS '录入时间' 
FROM
	Tstudent
```

等价于

```sql
SELECT
	StudentID '学号',
	Sname '姓名',
	sex '性别',
	cardID '身份证号',
	Birthday '生日',
	Email '邮件',
	Class '专业',
	enterTime '录入时间' 
FROM
	TStudent
```

#### 列的计算

请根据表中的出生年月日，算出学生的年龄？

```sql
SELECT *,(YEAR(CURDATE())-YEAR(`Birthday`)) AS '年龄' FROM `tstudent`
```

