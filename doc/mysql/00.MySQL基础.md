# MySQL基础学习手册
## 1 学习规划与核心说明
### 1.1 学习内容规划表
| 序号 | 学习模块 | 具体学习内容 | 重点标识 |
| ---- | -------- | ------------ | -------- |
| 1 | 学习数据库的意义 | 为什么要学习数据库 | - |
| 2 | 数据库基础概念 | DBMS、DB、SQL | - |
| 3 | 数据库核心特性 | 数据库存储数据的特点 | - |
| 4 | MySQL 入门 | MySQL 产品的介绍 | - |
| 4 | MySQL 入门 | MySQL 产品的安装 | ★ |
| 4 | MySQL 入门 | MySQL 服务的启动和停止 | ★ |
| 4 | MySQL 入门 | MySQL 服务的登录和退出 | ★ |
| 4 | MySQL 入门 | MySQL 的常见命令和语法规范 | - |
| 5 | DQL 语言学习 | 基础查询 | ★ |
| 5 | DQL 语言学习 | 条件查询 | ★ |
| 5 | DQL 语言学习 | 排序查询 | ★ |
| 5 | DQL 语言学习 | 常见函数 | ★ |
| 5 | DQL 语言学习 | 分组函数 | ★ |
| 5 | DQL 语言学习 | 分组查询 | ★ |
| 5 | DQL 语言学习 | 连接查询 | ★ |
| 5 | DQL 语言学习 | 子查询 | √ |
| 5 | DQL 语言学习 | 分页查询 | ★ |
| 5 | DQL 语言学习 | union 联合查询 | √ |
| 6 | DML 语言学习 | 插入语句 | ★ |
| 6 | DML 语言学习 | 修改语句 | ★ |
| 6 | DML 语言学习 | 删除语句 | ★ |
| 7 | DDL 语言学习 | 库和表的管理 | √ |
| 7 | DDL 语言学习 | 常见数据类型介绍 | √ |
| 7 | DDL 语言学习 | 常见约束 | √ |
| 8 | TCL 语言学习 | 事务和事务处理 | - |
| 9 | 数据库进阶 | 视图的讲解 | √ |
| 10 | 数据库进阶 | 变量 | - |
| 11 | 数据库进阶 | 存储过程和函数 | - |
| 12 | 数据库进阶 | 流程控制结构 | - |

### 1.2 表格说明
1. 重点标识列中，`★` 代表核心重点内容，`√` 代表已掌握或了解内容，`-` 代表待学习的基础内容。
2. 相同学习模块下的内容进行了归类，便于梳理学习进度。

## 2 数据库基础认知
### 2.1 数据库的好处
1. 持久化数据到本地
2. 可以实现结构化查询，方便管理

### 2.2 数据库相关概念
1. DB：数据库，保存一组有组织的数据的容器
2. DBMS：数据库管理系统，又称为数据库软件（产品），用于管理DB中的数据
3. SQL：结构化查询语言，用于和DBMS通信的语言

### 2.3 数据库存储数据的特点
1. 将数据放到表中，表再放到库中
2. 一个数据库中可以有多个表，每个表都有唯一的名字，表名具有唯一性
3. 表具有一些特性，定义了数据在表中如何存储，类似Java中“类”的设计
4. 表由列组成（也称为字段），所有表都是由一个或多个列组成，每一列类似Java中的“属性”
5. 表中的数据按行存储，每一行类似于Java中的“对象”

## 3 MySQL 入门操作
### 3.1 MySQL 产品的介绍和安装
（无具体操作细节，重点关注后续服务管理）

### 3.2 MySQL 服务的启动和停止
- 方式一：计算机——右击管理——服务
- 方式二：以管理员身份运行命令行
  - 启动服务：`net start 服务名`
  - 停止服务：`net stop 服务名`

### 3.3 MySQL 服务的登录和退出
#### 3.3.1 登录方式
- 方式一：通过MySQL自带的客户端（仅限root用户）
- 方式二：通过Windows自带的客户端
  ```
  mysql 【-h主机名 -P端口号 】-u用户名 -p密码
  ```

#### 3.3.2 退出方式
- `exit` 或 `ctrl+C`

### 3.4 MySQL 的常见命令
1. 查看当前所有的数据库：`show databases;`
2. 打开指定的库：`use 库名;`
3. 查看当前库的所有表：`show tables;`
4. 查看其它库的所有表：`show tables from 库名;`
5. 创建表：
   ```sql
   create table 表名(
       列名 列类型,
       列名 列类型，
       。。。
   );
   ```
6. 查看表结构：`desc 表名;`
7. 查看服务器的版本：
   - 登录到MySQL服务端：`select version();`
   - 未登录到MySQL服务端：`mysql --version` 或 `mysql --V`

### 3.5 MySQL 的语法规范
1. 不区分大小写，但建议关键字大写，表名、列名小写
2. 每条命令最好用分号结尾
3. 每条命令可根据需要缩进或换行
4. 注释方式：
   - 单行注释：`#注释文字`
   - 单行注释：`-- 注释文字`
   - 多行注释：`/* 注释文字  */`

### 3.6 SQL 的语言分类
1. DQL（Data Query Language）：数据查询语言，关键字 `select`
2. DML（Data Manipulate Language）：数据操作语言，关键字 `insert`、`update`、`delete`
3. DDL（Data Define Languge）：数据定义语言，关键字 `create`、`drop`、`alter`
4. TCL（Transaction Control Language）：事务控制语言，关键字 `commit`、`rollback`

## 4 DQL 语言学习（数据查询语言）
### 4.1 进阶1：基础查询
#### 4.1.1 语法
```sql
SELECT 要查询的东西
【FROM 表名】;
```
#### 4.1.2 特点
1. 查询结果是虚拟表格，非真实存在
2. 可查询常量值、表达式、字段、函数

### 4.2 进阶2：条件查询
#### 4.2.1 语法
```sql
select 
    要查询的字段|表达式|常量值|函数
from 
    表
where 
    条件 ;
```
#### 4.2.2 条件分类
1. 条件表达式：如 `salary>10000`，运算符包含 `> < >= <= = != <>`
2. 逻辑表达式：如 `salary>10000 && salary<20000`，运算符包含 `and（&&）`、`or(||)`、`not(!)`
3. 模糊查询：如 `last_name like 'a%'`

### 4.3 进阶3：排序查询
#### 4.3.1 语法
```sql
select
    要查询的东西
from
    表
where 
    条件
order by 排序的字段|表达式|函数|别名 【asc|desc】
```

### 4.4 进阶4：常见函数
#### 4.4.1 单行函数
1. 字符函数：`concat`（拼接）、`substr`（截取子串）、`upper`（转大写）、`lower`（转小写）、`trim`（去前后空格/字符）、`ltrim`（去左空格）、`rtrim`（去右空格）、`replace`（替换）、`lpad`（左填充）、`rpad`（右填充）、`instr`（返回子串首次索引）、`length`（获取字节数）
2. 数学函数：`round`（四舍五入）、`rand`（随机数）、`floor`（向下取整）、`ceil`（向上取整）、`mod`（取余）、`truncate`（截断）
3. 日期函数：`now`（当前日期+时间）、`curdate`（当前日期）、`curtime`（当前时间）、`str_to_date`（字符转日期）、`date_format`（日期转字符）
4. 流程控制函数：`if`（双分支）、`case`（多分支，支持等值/条件判断）
5. 其他函数：`version`（版本）、`database`（当前库）、`user`（当前连接用户）

#### 4.4.2 分组函数
1. 常用函数：`sum`（求和）、`max`（最大值）、`min`（最小值）、`avg`（平均值）、`count`（计数）
2. 特点：
   - 均忽略null值（`count(*)` 除外）
   - `sum`/`avg` 仅处理数值型；`max`/`min`/`count` 可处理任意数据类型
   - 可搭配 `distinct` 统计去重结果
   - `count` 参数支持字段、`*`、常量值（建议用 `count(*)`）

### 4.5 进阶5：分组查询
#### 4.5.1 语法
```sql
select 查询的字段，分组函数
from 表
group by 分组的字段
```
#### 4.5.2 特点
1. 可按单个/多个字段分组（多字段用逗号分隔）
2. 与分组函数一同查询的字段建议为分组字段
3. 分组筛选规则：
   | 筛选类型 | 针对表 | 位置 | 关键字 |
   |----------|--------|------|--------|
   | 分组前筛选 | 原始表 | group by 前 | where |
   | 分组后筛选 | 分组结果集 | group by 后 | having |
4. 支持排序，`having` 后可使用别名

### 4.6 进阶6：多表连接查询
#### 4.6.1 笛卡尔乘积问题
- 成因：连接条件省略/无效
- 解决：添加连接条件

#### 4.6.2 传统模式连接（等值/非等值连接）
- 等值连接结果为多表交集
- n表连接至少需要n-1个连接条件
- 多表无主次/顺序要求，建议起别名提升可读性

#### 4.6.3 SQL99 语法连接（join 关键字）
##### 4.6.3.1 语法
```sql
select 字段，...
from 表1
【inner|left outer|right outer|cross】join 表2 on 连接条件
【inner|left outer|right outer|cross】join 表3 on 连接条件
【where 筛选条件】
【group by 分组字段】
【having 分组后的筛选条件】
【order by 排序的字段或表达式】
```
##### 4.6.3.2 支持类型
- 内连接（等值/非等值）、外连接、交叉连接
- 优势：连接条件与筛选条件分离，简洁明了

#### 4.6.4 自连接
示例（查询员工名和直接上级名称）：
- SQL99 语法：
  ```sql
  SELECT e.last_name,m.last_name
  FROM employees e
  JOIN employees m ON e.`manager_id`=m.`employee_id`;
  ```
- SQL92 语法：
  ```sql
  SELECT e.last_name,m.last_name
  FROM employees e,employees m 
  WHERE e.`manager_id`=m.`employee_id`;
  ```

### 4.7 进阶7：子查询
#### 4.7.1 含义
一条查询语句嵌套另一条完整的 `select` 语句，嵌套的为子查询/内查询，外层的为主查询/外查询。

#### 4.7.2 特点
1. 子查询需放在小括号内
2. 可放在 `from`/`select`/`where`/`having` 后（一般在条件右侧）
3. 子查询优先执行，主查询使用其子查询结果
4. 分类：
   - 单行子查询：结果集仅一行，搭配单行操作符（`> < = <> >= <=`）
   - 多行子查询：结果集多行，搭配多行操作符（`any`/`all`/`in`/`not in`）

### 4.8 进阶8：分页查询
#### 4.8.1 应用场景
Web项目中按需分页展示数据

#### 4.8.2 语法
```sql
select 字段|表达式,...
from 表
【where 条件】
【group by 分组字段】
【having 条件】
【order by 排序的字段】
limit 【起始的条目索引，】条目数;
```
#### 4.8.3 特点
1. 起始条目索引从0开始
2. `limit` 子句放查询语句最后
3. 分页公式：`limit （page-1）*sizePerPage,sizePerPage`（`sizePerPage` 为每页条目数，`page` 为页码）

### 4.9 进阶9：联合查询
#### 4.9.1 语法
```sql
select 字段|常量|表达式|函数 【from 表】 【where 条件】 union 【all】
select 字段|常量|表达式|函数 【from 表】 【where 条件】 union 【all】
...
select 字段|常量|表达式|函数 【from 表】 【where 条件】
```
#### 4.9.2 特点
1. 多条查询语句的列数必须一致
2. 多条查询语句的列类型几乎相同
3. `union` 去重，`union all` 不去重

## 5 DML 语言学习（数据操作语言）
### 5.1 插入语句
#### 5.1.1 语法
```sql
insert into 表名(字段名，...)
values(值1，...);
```
#### 5.1.2 特点
1. 字段与值类型一致/兼容且一一对应
2. 可为空字段可省略值或用 `null` 填充
3. 不可为空字段必须赋值
4. 字段个数与值个数一致
5. 字段可省略（默认所有字段，顺序与表存储顺序一致）

### 5.2 修改语句
#### 5.2.1 单表修改
```sql
update 表名 set 字段=新值,字段=新值
【where 条件】
```
#### 5.2.2 多表修改
```sql
update 表1 别名1,表2 别名2
set 字段=新值，字段=新值
where 连接条件
and 筛选条件
```

### 5.3 删除语句
#### 5.3.1 delete 语句
- 单表删除：
  ```sql
  delete from 表名 【where 筛选条件】
  ```
- 多表删除：
  ```sql
  delete 别名1，别名2
  from 表1 别名1，表2 别名2
  where 连接条件
  and 筛选条件;
  ```

#### 5.3.2 truncate 语句
```sql
truncate table 表名
```

#### 5.3.3 两种删除方式的区别
1. `truncate` 不能加 `where` 条件，`delete` 可以
2. `truncate` 效率略高
3. `truncate` 删除带自增列的表后，新插入数据从1开始；`delete` 从断点开始
4. `truncate` 删除不可回滚，`delete` 可回滚

## 6 DDL 语言学习（数据定义语言）
### 6.1 库和表的管理
#### 6.1.1 库的管理
1. 创建库：`create database 库名;`
2. 删除库：`drop database 库名;`

#### 6.1.2 表的管理
1. 创建表：
   ```sql
   CREATE TABLE IF NOT EXISTS stuinfo(
       stuId INT,
       stuName VARCHAR(20),
       gender CHAR,
       bornDate DATETIME
   );
   ```
2. 修改表（`alter`）：
   - 修改字段名：`ALTER TABLE studentinfo CHANGE COLUMN sex gender CHAR;`
   - 修改表名：`ALTER TABLE stuinfo RENAME [TO] studentinfo;`
   - 修改字段类型/列级约束：`ALTER TABLE studentinfo MODIFY COLUMN borndate DATE ;`
   - 添加字段：`ALTER TABLE studentinfo ADD COLUMN email VARCHAR(20) first;`
   - 删除字段：`ALTER TABLE studentinfo DROP COLUMN email;`
3. 删除表：`DROP TABLE [IF EXISTS] studentinfo;`

### 6.2 常见数据类型
1. 整型
2. 小数：浮点型、定点型
3. 字符型
4. 日期型
5. Blob类型

### 6.3 常见约束
1. NOT NULL（非空）
2. DEFAULT（默认）
3. UNIQUE（唯一）
4. CHECK（检查）
5. PRIMARY KEY（主键）
6. FOREIGN KEY（外键）

## 7 TCL 语言学习（事务控制语言）
### 7.1 事务含义
通过一组逻辑操作单元（多条DML语句），将数据从一种状态切换到另一种状态。

### 7.2 事务特点（ACID）
1. 原子性：要么全执行，要么全回滚
2. 一致性：保证操作前后数据状态一致
3. 隔离性：多事务并发操作同一数据时，互不干扰
4. 持久性：事务提交后，数据持久化到本地

### 7.3 事务相关步骤
1. 开启事务
2. 编写事务逻辑操作单元（多条DML语句）
3. 提交/回滚事务

### 7.4 事务分类
#### 7.4.1 隐式事务
无明显开启/结束标志，如 `insert`/`update`/`delete` 语句本身即为一个事务。

#### 7.4.2 显式事务
有明显开启/结束标志：
1. 开启事务：取消自动提交（`set autocommit=0;` / `start transaction;`）
2. 编写逻辑操作单元
3. 提交（`commit;`）/回滚（`rollback;`）；支持断点（`savepoint`），可提交/回滚到断点（`commit to 断点`/`rollback to 断点`）

### 7.5 事务隔离级别
#### 7.5.1 并发问题
1. 脏读：读取到其他事务未提交的数据
2. 不可重复读：同一事务多次读取数据不一致
3. 幻读：一个事务读取时，另一事务更新导致读取到未更新数据

#### 7.5.2 隔离级别（从低到高）
1. READ UNCOMMITTED：无防护
2. READ COMMITTED：避免脏读
3. REPEATABLE READ：避免脏读、不可重复读、部分幻读
4. SERIALIZABLE：避免所有并发问题

#### 7.5.3 隔离级别操作
- 设置：`set session|global transaction isolation level 隔离级别名;`
- 查看：`select @@tx_isolation;`

## 8 数据库进阶
### 8.1 视图
#### 8.1.1 视图含义
虚拟表，仅保存SQL逻辑，不占用物理空间（表占用物理空间，二者使用方式相同）。

#### 8.1.2 视图好处
1. SQL语句重用性高、效率高
2. 与表分离，提升安全性

#### 8.1.3 视图操作
1. 创建：
   ```sql
   CREATE VIEW 视图名
   AS
   查询语句;
   ```
2. 增删改查：
   - 查询：`SELECT * FROM 视图名 [WHERE 条件];`
   - 插入：`INSERT INTO 视图名(字段) VALUES(值);`
   - 修改：`UPDATE 视图名 SET 字段=值 [WHERE 条件];`
   - 删除：`DELETE FROM 视图名 [WHERE 条件];`
3. 不可更新的视图（包含以下关键字/场景）：
   - 分组函数、`distinct`、`group by`、`having`、`union`/`union all`
   - 常量视图、select含子查询、join、从不可更新视图查询、where子查询引用from子句表
4. 逻辑更新：
   - 方式1：`CREATE OR REPLACE VIEW 视图名 AS 查询语句;`
   - 方式2：`ALTER VIEW 视图名 AS 查询语句;`
5. 删除：`DROP VIEW 视图名1,视图名2...;`
6. 查看结构：`DESC 视图名;` / `SHOW CREATE VIEW 视图名;`

### 8.2 存储过程
#### 8.2.1 含义
一组预先编译的SQL语句集合。

#### 8.2.2 好处
1. 提升SQL重用性，降低开发压力
2. 提高执行效率
3. 减少数据传输次数

#### 8.2.3 分类
1. 无返回无参
2. 仅带in类型（输入），无返回有参
3. 仅带out类型（输出），有返回无参
4. 带in+out类型，有返回有参
5. 带inout类型（输入输出），有返回有参

#### 8.2.4 创建与调用
1. 创建（需修改结束标记）：
   ```sql
   delimiter $
   CREATE PROCEDURE 存储过程名(in|out|inout 参数名 参数类型,...)
   BEGIN
       sql语句1;
       sql语句2;
   END $
   ```
2. 调用：`call 存储过程名(实参列表);`

### 8.3 函数
#### 8.3.1 创建语法
```sql
CREATE FUNCTION 函数名(参数名 参数类型,...) RETURNS 返回类型
BEGIN
    函数体
END
```

#### 8.3.2 调用语法
```sql
SELECT 函数名（实参列表）
```

#### 8.3.3 函数与存储过程的区别
| 对比项 | 函数 | 存储过程 |
|--------|------|----------|
| 关键字 | FUNCTION | PROCEDURE |
| 调用语法 | SELECT 函数() | CALL 存储过程() |
| 返回值 | 只能有一个 | 0个或多个 |
| 应用场景 | 查询单个值并返回 | 一般用于更新操作 |

### 8.4 流程控制结构
#### 8.4.1 变量
##### 8.4.1.1 系统变量
- 全局变量：作用于所有会话，不可跨重启
  - 查看：`SHOW GLOBAL VARIABLES [LIKE '匹配规则'];` / `SELECT @@global.变量名;`
  - 赋值：`SET @@global.变量名=值;` / `SET GLOBAL 变量名=值;`
- 会话变量：作用于当前会话
  - 查看：`SHOW SESSION VARIABLES [LIKE '匹配规则'];` / `SELECT @@session.变量名;` / `SELECT @@变量名;`
  - 赋值：`SET @@session.变量名=值;` / `SET SESSION 变量名=值;`

##### 8.4.1.2 自定义变量
- 用户变量：作用于当前会话，可在会话任意位置定义（加@，无需指定类型）
  - 声明初始化：`SET @变量名=值;` / `SET @变量名:=值;` / `SELECT @变量名:=值;`
  - 赋值：简单值（同声明）、表字段值（`SELECT 字段 INTO @变量 FROM 表;`）
  - 使用：`select @变量名;`
- 局部变量：作用于BEGIN END内，需在BEGIN END首行声明（不加@，需指定类型）
  - 声明：`declare 变量名 类型 【default 值】;`
  - 赋值/使用：同用户变量

#### 8.4.2 分支结构
##### 8.4.2.1 if函数
语法：`if(条件，值1，值2)`，可用于任意位置。

##### 8.4.2.2 case语句
- 等值判断（类似switch）：
  ```sql
  case 表达式
  when 值1 then 结果1/语句1;
  when 值2 then 结果2/语句2;
  ...
  else 结果n/语句n;
  end 【case】;
  ```
- 条件判断（类似多重if）：
  ```sql
  case 
  when 条件1 then 结果1/语句1;
  when 条件2 then 结果2/语句2;
  ...
  else 结果n/语句n;
  end 【case】;
  ```
- 特点：可用于任意位置。

##### 8.4.2.3 if elseif语句
```sql
if 情况1 then 语句1;
elseif 情况2 then 语句2;
...
else 语句n;
end if;
```
- 特点：仅可用于BEGIN END内。

##### 8.4.2.4 分支结构对比
| 结构 | 应用场合 |
|------|----------|
| if函数 | 简单双分支 |
| case语句 | 等值判断多分支 |
| if结构 | 区间判断多分支 |

#### 8.4.3 循环结构（WHILE循环）
```sql
【标签：】WHILE 循环条件  DO
    循环体
END WHILE 【标签】;
```
- 特点：仅可用于BEGIN END内；搭配`leave`（类似break）需加标签，否则可省略。