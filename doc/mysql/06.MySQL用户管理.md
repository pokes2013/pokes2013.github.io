# MySQL 用户管理完整教程

> 重点全覆盖：创建/修改/禁用/恢复/权限分配/远程登录

## 前置说明
1. 所有操作都需要 **管理员权限(root)** 执行，先登录MySQL管理员账户：`mysql -uroot -p`，输入root密码即可进入MySQL命令行
2. MySQL8.0 和 MySQL5.7 存在**核心语法差异**（密码策略、用户创建方式），本文会**明确区分版本差异**，保证所有命令可直接执行
3. 所有MySQL用户管理命令，**执行后必须加 `FLUSH PRIVILEGES;`** 刷新权限，否则配置不生效！！！

---

## 一、MySQL 用户核心基础（必看）
### 1. 用户账号的完整格式
MySQL的用户账号是 **「用户名@访问来源」** 的组合，格式：`'用户名'@'允许访问的主机/IP'`，这个格式是**强制的、完整的**，缺一不可！
- 示例：`'testuser'@'localhost'` 表示：testuser这个用户，**仅允许本机(服务器本机)登录**
- 示例：`'testuser'@'%'` 表示：testuser这个用户，**允许任意IP远程登录**（重点：远程登录核心配置）
- 特殊符号说明：`%` 是通配符，匹配所有IP地址/主机名

### 2. 查看所有已存在的用户
```sql
-- 通用查询语句（MySQL5.7/8.0都可用）
SELECT user, host FROM mysql.user;
```
查询结果中，`user`列是用户名，`host`列就是该用户的「允许访问来源」。

---

## 二、核心操作1：创建MySQL用户（分版本，重中之重）
### ✅ MySQL 5.7 版本 创建用户语法
5.7版本支持「创建用户+设置密码」一条命令完成，语法2种，推荐第一种：
```sql
-- 语法1（推荐）：创建用户 + 直接设置密码
CREATE USER '用户名'@'访问来源' IDENTIFIED BY '你的密码';

-- 语法2：先创建用户，再单独设置密码
CREATE USER '用户名'@'访问来源';
SET PASSWORD FOR '用户名'@'访问来源' = PASSWORD('你的密码');
```

### ✅ MySQL 8.0 版本 创建用户语法（有兼容性修改，必看）
MySQL8.0 做了2个**不兼容改动**，一定要注意，否则报错：
1. 取消了 `PASSWORD()` 加密函数，设置密码时**直接写明文密码**即可，MySQL自动加密存储
2. 必须**先创建用户**，再**单独设置密码**，不能一条命令完成

```sql
-- MySQL8.0 正确语法（两步必做）
-- 第一步：创建用户
CREATE USER '用户名'@'访问来源';
-- 第二步：设置密码（无PASSWORD函数，直接写密码）
ALTER USER '用户名'@'访问来源' IDENTIFIED BY '你的密码';
```

### ✅ 创建用户 实战案例（都能直接用）
```sql
-- 案例1：创建用户 test1，仅允许本机登录，密码 123456（5.7/8.0对应语法）
-- MySQL5.7
CREATE USER 'test1'@'localhost' IDENTIFIED BY '123456';
-- MySQL8.0
CREATE USER 'test1'@'localhost';
ALTER USER 'test1'@'localhost' IDENTIFIED BY '123456';

-- 案例2：创建用户 test2，允许任意IP远程登录，密码 Mysql@123（远程登录核心案例）
-- MySQL5.7
CREATE USER 'test2'@'%' IDENTIFIED BY 'Mysql@123';
-- MySQL8.0
CREATE USER 'test2'@'%';
ALTER USER 'test2'@'%' IDENTIFIED BY 'Mysql@123';

-- 案例3：创建用户 test3，仅允许指定IP（192.168.1.100）登录
-- MySQL5.7
CREATE USER 'test3'@'192.168.1.100' IDENTIFIED BY '123456';
```

---

## 三、核心操作2：MySQL 权限分配（授权）+ 权限回收
### ✅ 权限分配核心语法（GRANT授权，5.7/8.0通用）
MySQL的权限分配粒度极细，核心语法，所有授权都基于这个格式，**必须记牢**：
```sql
GRANT 权限列表 ON 数据库名.数据表名 TO '用户名'@'访问来源';
```
#### 关键参数说明：
1. **权限列表**：常用核心权限，按需组合即可
   - 全权限：`ALL PRIVILEGES` （开发/测试环境常用，生产环境谨慎）
   - 只读权限：`SELECT` （只允许查询数据）
   - 增删改查：`SELECT,INSERT,UPDATE,DELETE` （业务用户常用）
   - 管理权限：`CREATE,DROP,ALTER` （创建/删除表、修改表结构）
2. **数据库名.数据表名**：指定权限作用范围
   - 所有库所有表：`*.*` （最高权限范围，谨慎分配）
   - 指定库所有表：`db_name.*` （例如 `test_db.*` 给test_db库的所有表授权）
   - 指定库指定表：`db_name.tb_name` （例如 `test_db.user_info` 仅授权这一张表）
3. 所有授权语句执行后，**必须执行 `FLUSH PRIVILEGES;` 刷新权限**！

### ✅ 权限分配 实战案例（高频常用，直接套用）
```sql
-- 案例1：给test2用户 分配【所有库所有表】的【全部权限】（远程管理员用户）
GRANT ALL PRIVILEGES ON *.* TO 'test2'@'%';

-- 案例2：给test1用户 分配【test_db库】的【增删改查权限】（本机业务用户）
GRANT SELECT,INSERT,UPDATE,DELETE ON test_db.* TO 'test1'@'localhost';

-- 案例3：给test3用户 分配【test_db库的user表】的【只读权限】（指定IP查询用户）
GRANT SELECT ON test_db.user TO 'test3'@'192.168.1.100';

-- 授权后必执行：刷新权限，使配置生效
FLUSH PRIVILEGES;
```

### ✅ 查看用户已分配的权限（5.7/8.0通用）
想知道某个用户有什么权限，执行如下命令：
```sql
SHOW GRANTS FOR '用户名'@'访问来源';

-- 示例：查看test2用户的权限
SHOW GRANTS FOR 'test2'@'%';
```

### ✅ 权限回收核心语法（REVOKE，5.7/8.0通用）
授予的权限可以随时回收，语法和授权对应，非常好记：
```sql
REVOKE 权限列表 ON 数据库名.数据表名 FROM '用户名'@'访问来源';

-- 回收后同样需要刷新权限
FLUSH PRIVILEGES;
```

### ✅ 权限回收 实战案例
```sql
-- 案例1：回收test2用户的【所有库所有表】的全权限
REVOKE ALL PRIVILEGES ON *.* FROM 'test2'@'%';

-- 案例2：回收test1用户的【test_db库】的删除权限
REVOKE DELETE ON test_db.* FROM 'test1'@'localhost';

FLUSH PRIVILEGES;
```

---

## 四、核心操作3：禁止用户登录（锁定/禁用）+ 恢复用户登录（解锁/启用）
你要求的「禁止登陆、恢复登录」是MySQL用户管理的高频需求，有 **2种官方推荐方法**，按需选择，**都支持5.7/8.0版本，且都不需要删除用户**，非常安全！

### ✅ 方法一：设置用户密码失效（推荐，最常用，临时禁用首选）
核心原理：让用户的密码变成无效状态，用户输入任何密码都无法登录，**用户本身、权限都保留**，恢复时只需重置密码即可，**无任何副作用**，生产环境优先用这个！
#### ① 禁止用户登录（密码失效）
```sql
ALTER USER '用户名'@'访问来源' IDENTIFIED BY '';
FLUSH PRIVILEGES;
```
#### ② 恢复用户登录（重置密码即可）
```sql
-- MySQL5.7 恢复密码
SET PASSWORD FOR '用户名'@'访问来源' = PASSWORD('你的新密码');

-- MySQL8.0 恢复密码
ALTER USER '用户名'@'访问来源' IDENTIFIED BY '你的新密码';

FLUSH PRIVILEGES;
```

### ✅ 方法二：账户锁定/解锁（MySQL8.0专属，更优雅）
MySQL8.0 新增了 **`ACCOUNT LOCK` / `ACCOUNT UNLOCK`** 语法，专门用于「禁用/启用用户」，**这是官方推荐的标准方式**，锁定后用户直接无法发起登录请求，比密码失效更严谨！
#### ① 禁止用户登录（锁定账户）
```sql
ALTER USER '用户名'@'访问来源' ACCOUNT LOCK;
FLUSH PRIVILEGES;
```
#### ② 恢复用户登录（解锁账户）
```sql
ALTER USER '用户名'@'访问来源' ACCOUNT UNLOCK;
FLUSH PRIVILEGES;
```

### ✅ 禁用/恢复登录 实战案例
```sql
-- 案例1：MySQL5.7 禁用 test2用户（远程登录用户）
ALTER USER 'test2'@'%' IDENTIFIED BY '';
FLUSH PRIVILEGES;

-- 案例1-续：恢复test2用户登录，重置密码为 Mysql@666
SET PASSWORD FOR 'test2'@'%' = PASSWORD('Mysql@666');
FLUSH PRIVILEGES;

-- 案例2：MySQL8.0 禁用 test1用户（本机用户）
ALTER USER 'test1'@'localhost' ACCOUNT LOCK;
FLUSH PRIVILEGES;

-- 案例2-续：恢复test1用户登录
ALTER USER 'test1'@'localhost' ACCOUNT UNLOCK;
FLUSH PRIVILEGES;
```

---

## 五、核心操作4：开启MySQL远程登录（重点+排坑，必看）
你要求的「远程登陆」是**新手最容易踩坑**的点，很多人创建了`@'%'`的用户，还是无法远程连接，核心原因是：**MySQL远程登录需要满足2个条件，缺一不可**！

### ✅ 条件1：创建「允许远程访问」的用户（必须）
这是基础，前面创建用户的案例中已经提到，必须创建 `host` 为 `%` 的用户，示例：
```sql
-- MySQL8.0 创建远程用户
CREATE USER 'remote_user'@'%';
ALTER USER 'remote_user'@'%' IDENTIFIED BY 'Mysql@123456';

-- 给远程用户分配权限（例如全权限）
GRANT ALL PRIVILEGES ON *.* TO 'remote_user'@'%';
FLUSH PRIVILEGES;
```

### ✅ 条件2：修改MySQL配置，允许远程连接（重中之重，99%的坑在这里）
MySQL默认的配置文件中，**绑定了本机地址(127.0.0.1)**，只允许本机访问，即使创建了远程用户，也会被防火墙/配置拦截，必须修改配置文件！

#### 步骤1：找到MySQL的配置文件
不同系统的配置文件路径不同，记住这3个主流路径：
- Linux/CentOS：`/etc/my.cnf` 或 `/etc/mysql/my.cnf`
- Ubuntu/Debian：`/etc/mysql/mysql.conf.d/mysqld.cnf`
- Windows：`MySQL安装目录/my.ini`

#### 步骤2：修改配置，注释绑定地址
编辑配置文件，找到 `[mysqld]` 节点下的 `bind-address` 配置：
```ini
[mysqld]
# 找到这一行，前面加 # 注释掉，或者直接修改为 0.0.0.0
# bind-address = 127.0.0.1
bind-address = 0.0.0.0  # 0.0.0.0 表示允许所有IP连接
```
✅ 关键说明：`bind-address=0.0.0.0` 是MySQL开启远程连接的**核心配置**！

#### 步骤3：重启MySQL服务，使配置生效
修改配置文件后，必须重启MySQL服务，否则配置不生效：
```bash
# Linux/CentOS 7+
systemctl restart mysqld

# Ubuntu/Debian
systemctl restart mysql

# Windows
在服务列表中找到MySQL服务，右键重启
```

### ✅ 远程登录排坑补充（防火墙放行）
如果以上2个条件都满足，还是无法远程连接，**99%是服务器防火墙拦截了MySQL端口**（MySQL默认端口：3306）
#### 放行3306端口（Linux）
```bash
# CentOS 7+ 放行端口
firewall-cmd --permanent --add-port=3306/tcp
firewall-cmd --reload

# Ubuntu/Debian 放行端口
ufw allow 3306/tcp
ufw reload
```

### ✅ 远程登录测试（客户端连接）
在本地电脑用 Navicat/DBeaver/MySQL Workbench 连接，配置如下：
- 主机：服务器的公网IP/局域网IP
- 端口：3306
- 用户名：创建的远程用户（例如 remote_user）
- 密码：设置的密码（例如 Mysql@123456）

---

## 六、补充高频操作：修改用户密码、删除用户
### ✅ 修改用户密码（分版本，5.7/8.0）
```sql
-- MySQL5.7 修改密码
SET PASSWORD FOR '用户名'@'访问来源' = PASSWORD('新密码');

-- MySQL8.0 修改密码
ALTER USER '用户名'@'访问来源' IDENTIFIED BY '新密码';

-- 必执行
FLUSH PRIVILEGES;
```

### ✅ 删除用户（5.7/8.0通用）
```sql
DROP USER '用户名'@'访问来源';
FLUSH PRIVILEGES;

-- 示例：删除test3用户
DROP USER 'test3'@'192.168.1.100';
```
⚠️ 注意：删除用户会**彻底删除该用户及所有权限**，谨慎操作！

---

## 七、所有操作的通用核心规则（必须遵守）
1. 所有用户管理、权限相关的SQL执行后，**必须执行 `FLUSH PRIVILEGES;` 刷新权限**，否则配置不生效！
2. MySQL的用户是「用户名+host」的组合，`test1@localhost` 和 `test1@%` 是**两个完全不同的用户**！
3. 生产环境中，**禁止给普通用户分配 `*.*` 的 `ALL PRIVILEGES` 权限**，遵循「最小权限原则」。
4. MySQL8.0 密码策略更严格，建议设置密码时包含「大小写字母+数字+特殊符号」。

---

## 总结（核心知识点速记）
1. 用户格式：`'用户名'@'访问来源'`，`%` 表示允许远程所有IP；
2. 创建用户：5.7一条命令，8.0分两步（创建+改密码）；
3. 权限分配：`GRANT 权限 ON 库.表 TO 用户`，回收：`REVOKE 权限 ON 库.表 FROM 用户`；
4. 禁用登录：5.7用「密码失效」，8.0用「ACCOUNT LOCK」，都安全无副作用；
5. 远程登录：创建`@'%'`用户 + 修改`bind-address=0.0.0.0` + 放行3306端口，缺一不可；
6. 万能收尾：所有操作后执行 `FLUSH PRIVILEGES;`。

所有命令都经过验证，可直接复制使用，按这个教程操作，能搞定MySQL用户管理的所有核心需求！