#!/usr/bin/env node
"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
var fs = __importStar(require("fs"));
var path = __importStar(require("path"));
var ignores = /node_modules|^\.|_sidebar|_docsify/;
var isDoc = /.md$/;
function buildTree(location, name, tPath) {
    if (name === void 0) { name = ''; }
    if (tPath === void 0) { tPath = ''; }
    var children = [];
    for (var _i = 0, _a = fs.readdirSync(location); _i < _a.length; _i++) {
        var item = _a[_i];
        if (ignores.test(item))
            continue;
        var iPath = tPath + '/' + item;
        var iLocation = path.join(location, item);
        if (fs.statSync(iPath).isDirectory()) {
            children.push(buildTree(iLocation, item, iPath));
        }
        else if (isDoc.test(item)) {
            children.push({ name: item, path: iPath });
        }
    }
    return { name: name, children: children, path: tPath };
}
function renderToMd(tree) {
    if (!tree.children)
        return "- [" + tree.name.split('.')[0] + "](" + tree.path.replace(/ /g, '%20') + ")";
    else {
        var content = tree.children
            .map(function (c) { return renderToMd(c); })
            .join('\n')
            .split('\n')
            .map(function (item) { return '  ' + item; })
            .join('\n');
        var prefix = tree.name ? "- " + tree.name + "\n" : '';
        return prefix + content;
    }
}
var dir = process.env['DOCS_DIR'] || path.join(process.cwd(), 'docs');
try {
    var root = buildTree(dir);
    fs.writeFileSync(path.join(dir, '_sidebar.md'), renderToMd(root));
}
catch (e) {
    console.error('Unable to generate sidebar for directory', dir);
    console.error('Reason:', e.message);
    process.exit(1);
}
